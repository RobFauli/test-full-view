var labradorView;(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Entry:()=>_e,behaviours:()=>i});var i={};e.r(i),e.d(i,{adnuntiusAd:()=>m,apsis_submit:()=>f,article:()=>y,articleCalendar:()=>v,articleFooter:()=>_,articleHeader:()=>k,articleList:()=>w,articleMeta:()=>F,articlesByTag:()=>S,articlescroller:()=>T,bodytext:()=>C,byline:()=>x,comments:()=>$,factbox:()=>M,frontContent:()=>E,front_rows:()=>A,googleAd:()=>j,googleCSE:()=>P,graphic:()=>L,image:()=>R,jwplayer:()=>ne,labradorSearch:()=>U,markup:()=>B,mobiltests:()=>z,motortests:()=>W,newsletter_submit:()=>V,page_article:()=>u,page_front:()=>h,parallax:()=>Y,row:()=>ge,scrollbox:()=>de,simplestream:()=>J,slideshow:()=>G,tablebox:()=>K,tagboard:()=>Z,text_multiline:()=>X,timeline:()=>ce,tips_box:()=>ee,topcomments:()=>le,toplist:()=>ie,tvguide:()=>se,twitter:()=>ae,userFeedback:()=>re,youtube:()=>oe});class s{static getSiteStyles(e,t=[]){const i=lab_api.v1.config.get(`site_styles.${e}`)||t;return Sys.logger.debug(`ViewSupport: Found ${Array.isArray(i)?i.length:0} stylesheet(s) for site "${e}".`),i}static getSiteStylesWithFallback(e,t=[]){const i=this.getSiteStyles(e,null);if(null===i){t.push(e);const i=lab_api.v1.config.get("lab_fallback_site",{site:e});if(i&&!t.includes(i))return this.getSiteStylesWithFallback(i,t)}return i||[]}static getSiteScripts(e,t,i){const s=this.filterScriptListByPageType(lab_api.v1.config.get(`site_scripts.${e}`)||[],t,i);return Sys.logger.debug(`ViewSupport: Found ${s.length} script-path(s) for site "${e}".`),s}static getSiteScriptsWithFallback(e,t,i,s=[]){let a=this.getSiteScripts(e,t,i);if(s.length&&(a=this.removeWithInheritFalse(a)),!a.length){s.push(e);const a=lab_api.v1.config.get("lab_fallback_site",{site:e});if(a&&!s.includes(a))return this.getSiteScriptsWithFallback(a,t,i,s).filter((e=>!1!==e.inherit))}return a}static getCommonScripts(e,t,i=!1){const s=this.filterScriptListByPageType(lab_api.v1.config.get("site_scripts_common")||[],e,t,i);return Sys.logger.debug(`ViewSupport: Found ${s.length} common ${i?"script-path(s)":"JS modules"}`),s}static filterScriptListByPageType(e,t,i,s=!1){return e.filter((e=>(!e.isModule&&!s||e.isModule&&s)&&(!e.pageType||e.pageType===t)&&(!i||i&&!e.skipEditor)))}static removeWithInheritFalse(e){return Array.isArray(e)&&e.length>0?e.filter((e=>!1!==e.inherit)):e}static getSiteFilesForContentboxes(e,t,i,s=[]){const a=[],r=lab_api.v1.model.query.getModelTypes();Sys.logger.debug(`ViewSupport sitefiles: Will register ${i}-file(s) for contentbox-types ${r.join(", ")}.`);for(const e of r){const t=lab_api.v1.config.get(`contentbox_settings.${e}.require.${i}`);if(Array.isArray(t))for(const r of t)a.includes(r)||s.includes(r)||(Sys.logger.debug(`ViewSupport sitefiles: Will include ${i}-file "${r}" for contentbox "${e}".`),a.push(r))}return Sys.logger.debug(`ViewSupport sitefiles: Finished registering ${i}-file(s). Found ${a.length} file(s).`),a}}class a{constructor(e){this.api=e,this.pageType=this.api.v1.model.root.getType()}get media(){return{getLogo:(e=this.api.v1.viewport.getName())=>{const t=this.api.v1.config.get("logo")||{},i=t.uploadedFileUrl?{src:t.uploadedFileUrl,href:t.default.href,type:"img",size:{width:t.logoWidth},title:t.default.title,isCustom:!0}:t[e]||t.default||null;return i&&("img"===i.type?i.is_img=!0:"svg"===i.type&&(i.is_svg=!0)),{current:i,sm:t.uploadedFileUrl?{src:t.uploadedFileUrl,href:t.default.href,size:{width:t.logoWidth},title:t.default.title,isCustom:!0}:t.standalone||t.mailmojo||null}}}}get menus(){return{get:({section:e,defaultSection:t}={},i)=>{const s={},a=Object.values(this.api.v1.config.get("menus")||{});if(a.length<1)return null;const r=i=>{i.forEach((i=>{i.selected=i.section===e||i.section===t,"target"in i||(i.target="_self"),"selector"in i||(i.selector=""),"children"in i||(i.children=[]),i.children.length>0&&(i.hasChildren=!0,r(i.children))}))};return a.forEach((e=>{r(e.menuItems);const t=e.type||e.menuName;s[t]={items:e.menuItems,type:e.type,selector:e.selector||""}})),i?s[i]:s}}}get misc(){return{}}get resources(){const e={required:[],getProgressReader:()=>(e.required.push({url:"/view-resources/public/common/ReadProgress.js",requireDom:!1}),{active:!0,minElementCount:lab_api.v1.config.get("displayReadProgress.minElementCount")||25}),getSiteFiles(t,i,a,r,o){const n=s.getSiteScriptsWithFallback(a,r,o),l=s.getCommonScripts(r,o);return e.required.push(...n,...l),{js:s.getSiteFilesForContentboxes(t,i,"js",e.required.map((e=>e.url))),css:s.getSiteFilesForContentboxes(t,i,"css")}},getModules:(e,t,i,a,r)=>s.getCommonScripts(a,r,!0)},t={get:()=>{const e=(lab_api.v1.config.get("analytics.kilkaya")||[]).map((e=>{const t={...e};return t.id&&"string"==typeof t.id&&t.id.trim().endsWith(".js")&&(t.url=t.id),t}));let i=this.api.v1.config.get("analytics.adnuntiusConnect");i&&"object"==typeof i&&!Array.isArray(i)&&Object.keys(i).length&&(i=new Array(i));const s={google:this.api.v1.config.get("analytics.google.tracking_id"),google_gtm:this.api.v1.config.get("analytics.google.gtm"),comscore:this.api.v1.config.get("analytics.comscore.comscore_id"),adnuntiusConnect:i,adnuntiusConnectCMP:this.api.v1.config.get("analytics.adnuntiusConnectCMP"),kilkaya:e,kilkayaSettings:this.api.v1.config.get("analytics.kilkayaSettings"),io:this.api.v1.config.get("analytics.io.tracking_id")},a=t.getDataLayer();return a.dataLayer&&(s.dataLayer=a.dataLayer),a.usesJWTCookieData&&(s.usesJWTCookieData=a.usesJWTCookieData),s},getDataLayer:()=>{const e=this.api.v1.config.get("analytics.google.dataLayer");let t=!1;if(e&&Array.isArray(e)&&e.length){e.forEach((e=>{let i=null;switch(e.source){case"config":i=this.api.v1.properties.get(e.value);break;case"jwtcookie":e.isJWTCookie=!0,i=e.value,t=!0;break;case this.pageType.replace("page_",""):i=this.api.v1.model.query.getRootModel().get(e.value)}e.value=null===i?"":i.toString()}));const i=e.map((e=>e.value.length>0)).lastIndexOf(!0);e[i]&&(e[i].last=!0)}return{dataLayer:e,usesJWTCookieData:t}}};return{scripts:e,analytics:t}}get settings(){return{get:(e={})=>{const t=this.api.v1.config.get(`page_settings.${e.pageType}.social.display`)||{},i=this.api.v1.model.query.getRootModel().get("fields.show_social_bodytext_before"),s=this.api.v1.model.query.getRootModel().get("fields.show_social_bodytext_after"),a=this.api.v1.model.query.getRootModel().get("fields.show_social_header");null!==i&&(t.bodytext_before=!!i),null!==s&&(t.bodytext_after=!!s),null!==a&&(t.header=!!a);const r=this.api.v1.config.get(`page_settings.${e.pageType}.social.items`)||{},o=this.api.v1.config.get(`page_settings.${e.pageType}.showTags`),n=Object.keys(r).filter((e=>!!r[e].display)).map((t=>({name:t,icon:r[t].icon||"",url:e.socialLinks[t]||"",shareText:r[t].shareText||"",isButton:r[t].isButton||!1})));return{page_type:e.pageType,social:{display:{bodytext_before:n.length>0&&!!t.bodytext_before,bodytext_after:n.length>0&&!!t.bodytext_after,header:n.length>0&&!!t.header},items:n},showTags:!1!==o}}}}}class r{static getStyleDefinitions(e){const t=e.v1.properties.get("site.alias"),i=e.v1.config.get("style_definitions",t),s=[];(i.rules||[]).forEach((e=>s.push(e))),(i.fontface||[]).forEach((e=>{const t=`.font-${e.family.replace(/ /g,"")}`;s.push(r.getFamilyDefinition(t,e.family));const i={light:{keys:["light","200","100","300"],used:!1},normal:{keys:["regular","normal","400","500"],used:!1},bold:{keys:["bold","600","700"],used:!1},black:{keys:["black","800","900"],used:!1}};e.variants.forEach((e=>{for(const a of Object.keys(i)){const o=i[a];o&&!o.used&&o.keys.indexOf(e)>-1&&(s.push(r.getWeightDefinition(t,e,a)),o.used=!0)}}))}));const a={fontface:i.fontface||[],parsedRules:r.CSSRuleParser(s)};return a.hasRules=!!a.parsedRules.length,a}static getFamilyDefinition(e,t){return{selector:e,declarations:[{key:"font-family",value:`"${t}" !important`}]}}static getWeightDefinition(e,t,i){let s=t;return"regular"===t&&(s="normal"),{selector:`${e}.font-weight-${i}`,declarations:[{key:"font-weight",value:`${s} !important`}]}}static CSSRuleParser(e){const t=[];return e.forEach((e=>{let i,s,a=`${e.selector} { `;e.declarations.forEach((e=>{"font-size-desktop"===e.key?"default"!==e.value&&(a+=`font-size: ${e.value.slice(0,-2)/16}rem; `):"font-size-mobile"===e.key?"default"!==e.value&&(i=`calc(0.262vw * ${e.value.slice(0,-2)})`):"line-height-desktop"===e.key?"default"!==e.value&&(a+=`line-height: ${e.value}; `):"line-height-mobile"===e.key?"default"!==e.value&&(s=e.value):"font-family"===e.key?e.value.includes("!important")?a+=`${e.key}: ${e.value}; `:a+=`${e.key}: "${e.value}"; `:a+=`${e.key}: ${e.value}; `})),a+="}",(i||s)&&(a+=`@media (max-width: 767px) { .resp_fonts ${e.selector} {`,i&&(a+=`font-size: ${i}; `),s&&(a+=`line-height: ${s}; `),a+="} }"),t.push(a)})),t}static getInlineCSS(e,t){return[{key:"custom_properties",value:e.v1.config.get("css_build.custom_properties",{site:t})||""},{key:"background_colors",value:e.v1.config.get("css_build.background_colors",{site:t})||""},{key:"background_colors_opacity",value:e.v1.config.get("css_build.background_colors_opacity",{site:t})||""},{key:"border_colors",value:e.v1.config.get("css_build.border_colors",{site:t})||""},{key:"font_colors",value:e.v1.config.get("css_build.font_colors",{site:t})||""},{key:"image_gradient",value:e.v1.config.get("css_build.image_gradient",{site:t})||""}]}}const o={sunday:{en:"sunday",sv:"söndag",dk:"søndag",no:"søndag",nl:"zondag",kl:"sapaat"},monday:{en:"monday",sv:"måndag",dk:"mandag",no:"mandag",nl:"maandag",kl:"ataasinngorneq"},tuesday:{en:"tuesday",sv:"tisdag",dk:"tirsdag",no:"tirsdag",nl:"dinsdag",kl:"marlunngorneq"},wednesday:{en:"wednesday",sv:"onsdag",dk:"onsdag",no:"onsdag",nl:"woensdag",kl:"pingasunngorneq"},thursday:{en:"thursday",sv:"torsdag",dk:"torsdag",no:"torsdag",nl:"donderdag",kl:"sisamanngorneq"},friday:{en:"friday",sv:"fredag",dk:"fredag",no:"fredag",nl:"vrijdag",kl:"tallimanngorneq"},saturday:{en:"saturday",sv:"lördag",dk:"lørdag",no:"lørdag",nl:"zaterdag",kl:"arfininngorneq"},january:{en:"January",sv:"januari",dk:"januar",no:"januar",nl:"januari",kl:"ukiortaarsiorneq"},february:{en:"February",sv:"februari",dk:"februar",no:"februar",nl:"februari",kl:"ukiortaami"},mars:{en:"March",sv:"mars",dk:"marts",no:"mars",nl:"maart",kl:"marsi"},april:{en:"April",sv:"april",dk:"april",no:"april",nl:"april",kl:"apriili"},may:{en:"May",sv:"maj",dk:"maj",no:"mai",nl:"mei",kl:"maajii"},june:{en:"June",sv:"juni",dk:"juni",no:"juni",nl:"juni",kl:"juuni"},july:{en:"July",sv:"juli",dk:"juli",no:"juli",nl:"juli",kl:"juuli"},august:{en:"August",sv:"augusti",dk:"august",no:"august",nl:"augustus",kl:"aggusti"},september:{en:"September",sv:"september",dk:"september",no:"september",nl:"september",kl:"septembari"},october:{en:"October",sv:"oktober",dk:"oktober",no:"oktober",nl:"oktober",kl:"oktobari"},november:{en:"November",sv:"november",dk:"november",no:"november",nl:"november",kl:"novembari"},december:{en:"December",sv:"december",dk:"december",no:"desember",nl:"december",kl:"decembari"},ago:{en:"ago",sv:"sedan",dk:"siden",no:"siden",nl:"geleden",kl:"matuma siorna"},now:{en:"now",sv:"nu",dk:"nu",no:"nå",nl:"nu",kl:"maanna"},min:{en:"min"},minutes:{en:"minutes",sv:"minuter",dk:"minutter",no:"minutter",nl:"minuten",kl:"minutsi"},hour:{en:"hour",sv:"timme",dk:"time",no:"time",nl:"uur",kl:"akunnera"},hours:{en:"hours",sv:"timmar",dk:"timer",no:"timer",nl:"uren",kl:"akunnerit"},day:{en:"day",sv:"dag",dk:"dag",no:"dag",nl:"dag",kl:"ulloq"},days:{en:"days",sv:"dagar",dk:"dage",no:"dager",nl:"dagen",kl:"ullut"},monthdayyear:{en:"{{MMMM}} {{DD}}. {{YYYY}}",sv:"{{DD}}/{{MM}} {{YYYY}}",dk:"{{DD}}/{{MM}} {{YYYY}}",no:"{{DD}}/{{MM}} {{YYYY}}",nl:"{{DD}}/{{MM}} {{YYYY}}"},hourminute:{en:"{{HH}}:{{mm}}"}};class n{constructor(e="en",t="en"){this.fallbackLanguage=t,this.language=e||t,this.words=o,this.timezone=this.getTimezone()}getTimezone(){const e=lab_api.v1.config.get("timezone");return void 0===e||Number.isNaN(e)||Number.isNaN(parseFloat(e))?1:parseInt(e,10)}str(e){let{language:t}=this;return e in this.words?(t in this.words[e]||(t=this.fallbackLanguage),t in this.words[e]?this.words[e][t]:null):null}format(e,t){return Mustache.render(t,{YYYY:()=>e.getFullYear(),YY:()=>`${e.getFullYear()}`.slice(-2),MM:()=>(e.getMonth()<9?"0":"")+(e.getMonth()+1),M:()=>e.getMonth()+1,D:()=>e.getDate(),DD:()=>(e.getDate()<10?"0":"")+e.getDate(),H:()=>e.getHours(),HH:()=>(e.getHours()<10?"0":"")+e.getHours(),m:()=>e.getMinutes(),mm:()=>(e.getMinutes()<10?"0":"")+e.getMinutes(),s:()=>e.getSeconds(),ss:()=>(e.getSeconds()<10?"0":"")+e.getSeconds(),dddd:()=>this.weekday(e,!1),ddd:()=>this.weekday(e,!1,3),MMMM:()=>this.monthName(e,!1),MMM:()=>this.monthName(e,!1,3),W:()=>this.weekNumber(e,!0,!0),WW:()=>this.weekNumber(e,!0,!1)})}utcFormat(e,t){const i=this.correctDate(e);return Mustache.render(t,{YYYY:()=>i.getUTCFullYear(),YY:()=>`${i.getUTCFullYear()}`.slice(-2),MM:()=>(i.getUTCMonth()<9?"0":"")+(i.getUTCMonth()+1),M:()=>i.getUTCMonth()+1,D:()=>i.getUTCDate(),DD:()=>(i.getUTCDate()<10?"0":"")+i.getUTCDate(),H:()=>i.getUTCHours(),HH:()=>(i.getUTCHours()<10?"0":"")+i.getUTCHours(),m:()=>i.getUTCMinutes(),mm:()=>(i.getUTCMinutes()<10?"0":"")+i.getUTCMinutes(),s:()=>i.getUTCSeconds(),ss:()=>(i.getUTCSeconds()<10?"0":"")+i.getUTCSeconds(),dddd:()=>this.weekday(i,!0),ddd:()=>this.weekday(i,!0,3),MMMM:()=>this.monthName(i,!0),MMM:()=>this.monthName(i,!0,3),W:()=>this.weekNumber(i,!0,!0),WW:()=>this.weekNumber(i,!0,!1)})}formattedDate(e,t,i=!0,s=!0){let a=t||"";return a=a.replace("Y",e.getFullYear()),a=a.replace("m",(i&&e.getMonth()<9?"0":"")+(e.getMonth()+1)),a=a.replace("d",(i&&e.getDate()<10?"0":"")+e.getDate()),a=a.replace("H",(s&&e.getHours()<10?"0":"")+e.getHours()),a=a.replace("i",(s&&e.getMinutes()<10?"0":"")+e.getMinutes()),a=a.replace("s",e.getSeconds()),a=a.replace("l",this.weekday(e,!1)),a=a.replace("D",this.weekday(e,!1,3)),a=a.replace("F",this.monthName(e,!1)),a=a.replace("M",this.monthName(e,!1,3)),a}formattedUtcDate(e,t,i=!0,s=!0){const a=this.correctDate(e);let r=t||"";return r=r.replace("Y",a.getUTCFullYear()),r=r.replace("m",(i&&a.getUTCMonth()<9?"0":"")+(a.getUTCMonth()+1)),r=r.replace("d",(i&&a.getUTCDate()<10?"0":"")+a.getUTCDate()),r=r.replace("H",(s&&a.getUTCHours()<10?"0":"")+a.getUTCHours()),r=r.replace("i",(s&&a.getUTCMinutes()<10?"0":"")+a.getUTCMinutes()),r=r.replace("s",a.getUTCSeconds()),r=r.replace("l",this.weekday(a,!0)),r=r.replace("D",this.weekday(a,!0,3)),r=r.replace("F",this.monthName(a,!0)),r=r.replace("M",this.monthName(a,!0,3)),r}correctDate(e){return this.manipulateTime(e,this.isSummerTime(e)?this.timezone+1:this.timezone)}utcDate(e){return this.unmanipulateTime(e,this.isSummerTime(e)?this.timezone+1:this.timezone)}timestampToDate(e){return new Date(1e3*e)}toTimestamp(e){return Math.round(e.getTime()/1e3)}parseDate(e){const t=e.substr(0,4),i=e.substr(4,2)-1,s=e.substr(6,2),a=new Date(t,i,s),r=a.getFullYear()==t,o=a.getMonth()==i,n=a.getDate()==s;return r&&o&&n?a:"invalid date"}weekday(e,t=!1,i=9){return([this.str("sunday"),this.str("monday"),this.str("tuesday"),this.str("wednesday"),this.str("thursday"),this.str("friday"),this.str("saturday")][t?e.getUTCDay():e.getDay()]||"").substr(0,i)}monthName(e,t=!1,i=10){return([this.str("january"),this.str("february"),this.str("mars"),this.str("april"),this.str("may"),this.str("june"),this.str("july"),this.str("august"),this.str("september"),this.str("october"),this.str("november"),this.str("december")][t?e.getUTCMonth():e.getMonth()]||"").substr(0,i)}weekNumber(e,t=!1,i=!0){const s=new Date(e.valueOf()),a=((t?e.getUTCDay():e.getDay())+6)%7;s.setDate(s.getDate()-a+3);const r=s.valueOf();s.setMonth(0,1),4!==s.getDay()&&s.setMonth(0,1+(4-s.getDay()+7)%7);const o=1+Math.ceil((r-s)/6048e5);return(!i&&o<10?"0":"")+o}timestampToNiceDate(e,t=!1){const i={ago:t?"":this.str("ago"),now:this.str("now"),minute:t?this.str("min"):this.str("minutes"),minutes:t?this.str("min"):this.str("minutes"),hour:this.str("hour"),hours:this.str("hours"),day:this.str("day"),days:this.str("days")},s=(new Date).getTime(),a=new Date(1e3*e).getTime()-0,r=parseInt((s-a)/1e3/60,10);return r<60?r<1?i.now:1==r?`1 ${i.minute} ${i.ago}`:`${r} ${i.minutes} ${i.ago}`:r<1440?1==parseInt(r/60,10)?`1 ${i.hour} ${i.ago}`:`${parseInt(r/60,10)} ${i.hours} ${i.ago}`:parseInt(r/1440,10)<30?1==parseInt(r/1440,10)?`1 ${i.day} ${i.ago}`:`${parseInt(r/1440,10)} ${i.days} ${i.ago}`:this.format(this.timestampToDate(e),this.str("monthdayyear"))}isSummerTime(e){function t(e,t){const i=new Date,s=new Date(Date.UTC(t||i.getFullYear(),e+1,0)),a=s.getDay();return new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate()-a))}const i=e||new Date,s=t(2,i.getFullYear());s.setHours(1);const a=t(9,i.getFullYear());return s.setHours(1),i.getTime()>=s.getTime()&&i.getTime()<a.getTime()}manipulateTime(e,t){return new Date(e.getTime()+60*t*60*1e3)}unmanipulateTime(e,t){return new Date(e.getTime()-60*t*60*1e3)}}class l{static getAdnuntiusSettings(e,t,i,s,a){const r=(e.v1.config.get("contentbox_settings.adnuntiusAd.bidding")||{}).enabled||!1;function o(e,t){let i="";return r&&e.prebidConfig&&(i=JSON.parse(e.prebidConfig),Array.isArray(i)&&([i]=i),i=JSON.stringify(i)),{...e,prebidConfig:i,metadata:t.metadata||[]}}const l=e.v1.config.get("contentbox_settings.adnuntiusAd.formats")||[],d=e.v1.config.getView(`insertDynamic.${e.v1.model.root.getType().replace("page_","")}.${i.getViewport()}`,a.alias)||[],g=e.v1.model.query.getChildrenOfType(t,"adnuntiusAd",!0,!0),c=[];for(const e of d){const[t]=l.filter((t=>e.content_data.fields.format===t.format));t&&c.push(o(t,e))}for(const e of g){const[t]=l.filter((t=>e.get("fields.format")===t.format));t&&c.push(o(t,e))}const p=(new n).utcFormat(new Date,"&tag=week_{{ W }}_{{ YYYY }}");return{enabled:l.length>0,lazyload:e.v1.config.get("contentbox_settings.adnuntiusAd.lazyload")||!1,adUnits:c,spacingTop:e.v1.config.get("contentbox_settings.adnuntiusAd.spacingTop")||120,bidding:{enabled:r},hideOnTabletWidth:s.hideOnTabletWidth||1316,refreshdelay:e.v1.config.get("contentbox_settings.adnuntiusAd.refreshdelay")||5,refreshcount:e.v1.config.get("contentbox_settings.adnuntiusAd.refreshcount")||1,connectLoading:e.v1.config.get("contentbox_settings.adnuntiusAd.connectLoading")||!1,contkitEnabled:e.v1.config.get("contentbox_settings.adnuntiusAd.contkitEnabled")||!1,newsletter:{targeting:p}}}static getGoogleSettings(e,t,i,s,a){function r(e,t){const{sizes:i=[]}=e;return{...e,sizesString:`[${i.map((e=>`[${e.width},${e.height}]`)).join(", ")}]`,metadata:t.metadata||[]}}const o=e.v1.config.get("contentbox_settings.googleAd.formats")||[],n=e.v1.config.get("contentbox_settings.googleAd.anchor")||{enabled:!1,code:"",type:"TOP_ANCHOR"},l=e.v1.config.getView(`insertDynamic.${e.v1.model.root.getType().replace("page_","")}.${i.getViewport()}`,a.alias)||[],d=e.v1.model.query.getChildrenOfType(t,"googleAd",!0,!0),g=[];for(const e of l){const[t]=o.filter((t=>e.content_data.fields.format===t.format));t&&g.push(r(t,e))}for(const e of d){const[t]=o.filter((t=>e.get("fields.format")===t.format));t&&g.push(r(t,e))}return{enabled:o.length>0,lazyload:s.lazyload||!1,spacingTop:e.v1.config.get("contentbox_settings.googleAd.spacingTop")||120,adUnits:g,anchor:n,dfpid:s.dfpid||!1,debugmode:s.debugmode||!1,bidding:s.bidding,hideOnTabletWidth:s.hideOnTabletWidth||1316}}}class d{constructor({pageType:e="",canonical:t="",isTagpage:i=!1,isTagpageWithFrontpage:s=!1,tagpagePath:a="/tag/"}={}){this.settings={pageType:e,canonical:t,isTagpage:i,isTagpageWithFrontpage:s,tagpagePath:a},this.cache={seoData:null}}getStructuredData(e){return e.get("fields.jsonld_json")?e.get("fields.custom_jsonld"):"front"===this.settings.pageType?this.generateFrontData(e):"article"===this.settings.pageType?this.generateArticleData(e):null}generateSiteData(e){return{"@context":"http://schema.org","@type":"WebSite",name:lab_api.v1.properties.get("site.display_name"),url:lab_api.v1.properties.get("site.domain")||""}}generateFrontData(e){const t=this.getSEOData(e);return{"@context":"https://schema.org","@type":"WebPage",name:t.title,description:t.description}}generateArticleData(e){const t=this.getSEOData(e),i={"@context":"https://schema.org","@type":"NewsArticle",headline:t.title,description:t.description,availableLanguage:[{"@type":"Language",alternateName:t.language}],author:lab_api.v1.model.query.getChildrenOfType(e,"byline",!0).map((e=>{let t=e.get("fields.firstname");"Byline first name"===t&&(t="");let i=e.get("fields.lastname");"Byline last name"===i&&(i="");const s={"@type":"Person",name:`${t} ${i}`},a=e.get("fields.public_url");a&&(s.url=a);const r=(e.children||[]).filter((e=>"image"===e.type))[0];r&&(s.image={"@type":"ImageObject",url:`${r.get("fields.imageurl")}&width=250`});const o=e.get("fields.public_email");return o&&(s.email=o),s})),publisher:{"@type":"Organization",name:lab_api.v1.properties.get("site.display_name"),logo:{"@type":"ImageObject",url:lab_api.v1.config.get("logo.default.src")}}};return e.get("fields.published")&&(i.datePublished=new Date(1e3*parseInt(e.get("fields.published"),10)).toISOString()),e.get("fields.modified")&&(i.dateModified=new Date(1e3*parseInt(e.get("fields.modified"),10)).toISOString()),"1"===e.get("fields.paywall")&&(i.isAccessibleForFree=!0,i.hasPart={"@type":"WebPageElement",isAccessibleForFree:!1,cssSelector:".teaserContent"}),i}getSEOData(e){if(this.cache.seoData)return this.cache.seoData;let t,i,s;if("article"===this.settings.pageType)i=e.get("fields.seotitle")||e.get("fields.title")||"",s=e.get("fields.seodescription")||e.get("fields.subtitle")||"",t=e.get("fields.seolanguage")||lab_api.v1.config.get("contentLanguage");else{if(this.settings.isTagpage&&!this.settings.isTagpageWithFrontpage){const e=this.settings.tagpagePath.replace(/\//g,""),t=(this.settings.canonical.split(this.settings.tagpagePath)[1]||"").split("/").filter((e=>!!e)),s={tag:t[t.length-1],tags:t,tagPath:e};i=lab_api.v1.locale.get("tags.title_text",{data:s})}else i=e.get("fields.seotitle")||e.get("fields.name")||"";s=e.get("fields.seodescription")||""}return this.cache.seoData={title:i.charAt(0).toUpperCase()+i.slice(1),description:s,language:t},this.cache.seoData}}class g{static prepareForTemplate(e,t,i){const s={meta:{head_top:[],head_bottom:[]},script:{head_top:[],head_bottom:[],body_top:[],body_bottom:[]},link:{head_top:[],head_bottom:[]}},a=e.filter((e=>!(e.pageType&&e.pageType!==t||e.skipEditor&&i)));for(const e of Object.keys(s))for(const t of Object.keys(s[e]))s.meta[t]=a.filter((e=>"meta"===e.tag)).filter((e=>e.placement===t)).map((e=>this.createCustomTag(e))),s.script[t]=a.filter((e=>"script"===e.tag)).filter((e=>e.placement===t)).map((e=>this.createCustomTag(e))),s.link[t]=a.filter((e=>"link"===e.tag)).filter((e=>e.placement===t)).map((e=>this.createCustomTag(e)));return s}static createCustomTag(e){switch(e.tag){case"link":return this.createLinkTag(e);case"script":return this.createScriptTag(e);default:return this.createMetaTag(e)}}static fetchDynamicAttribute(e){return lab_api.v1.view.render({model:lab_api.v1.model.query.getRootModel(),template:e})||null}static parseAttributes(e){return e.filter((e=>!!e.key)).map((e=>e.value?`${e.key}="${e.value.match(/\{\{.*\}\}/g)?this.fetchDynamicAttribute(e.value):e.value}"`:e.key)).join(" ")}static parseVariables(e){return e.replace(/\{\{\{?.*?\}\}\}?/g,this.fetchDynamicAttribute)}static createLinkTag(e){return`<link ${this.parseAttributes(e.attributes)}>`}static createScriptTag(e){return`<script ${this.parseAttributes(e.attributes)}>${e.value?this.parseVariables(e.value):""}<\/script>`}static createMetaTag(e){return`<meta ${this.parseAttributes(e.attributes)}>`}}class c{constructor(e,t){this.api=e,this.page=t}set(e,t){const i=this.export(e,t);for(const t of Object.keys(i))e.setFiltered(t,i[t])}export(e,t){const i={},a=new Date,o=t.get("type").replace("page_",""),n=t.get("id"),c=this.api.v1.site.getSite().domain||this.api.v1.properties.get("customer_front_url"),p=c+t.get("fields.published_url"),u=encodeURIComponent(p),h=this.api.v1.properties.get("image_server"),m=this.api.v1.app.mode.isEditor(),f=this.getCanonicalUrl(e,o,n,c),b=this.api.v1.config.get("tagPagePath")||"/tag/",y="front"===o&&(p.endsWith(b.slice(0,-1))||p.indexOf(b)>-1),v=y&&!p.endsWith(b.slice(0,-1));i.customer_front_url=c,i.isEditMode=m,i.url=p,i.urlEncoded=u,i.specificUrl=f,i.image_server=h,i.pageType=o,i.is_article="article"===o,i.is_front="front"===o,i.section=t.get("primaryTags.section")||t.get("fields.defaultsection"),i.device=this.api.v1.viewport.getName(),i.cmsVersion=this.api.v1.properties.get("app.version"),i.front_api_url=this.api.v1.properties.get("front_api_url"),i.xUaDevice=this.api.v1.properties.get("xUaDevice"),i.favicons=this.api.v1.config.get("favicons"),i.faviconList=this.api.v1.config.get("faviconList"),i.skipDefaultFont=this.api.v1.config.get("skipDefaultFont"),i.isDebug=this.api.v1.util.request.hasQueryParam("debug"),i.staticUrl=this.getStaticUrl(e,o,n,c),i.customMetatags=this.getCustomMetatags(),i.customTags=g.prepareForTemplate(this.api.v1.config.get("customTags")||[],o,m),i.footerSettings=this.api.v1.config.get("page_settings.footer"),i.rssDescriptionPrefix=this.api.v1.config.get("viewports.rss.descriptionPrefix"),i.is_tagpage=y,i.contentLanguage=lab_api.v1.config.get("contentLanguage");const _=this.page.media.getLogo();i.logo=_.current,i.logo_sm=_.sm,i.misc=this.api.v1.config.get("misc");const k={active:!1,lang:this.api.v1.config.get("google_translate")};if(k.lang&&Array.isArray(k.lang)&&k.lang.length&&(k.active=!0),i.google_translate=k,i.social={facebook:`https://www.facebook.com/sharer.php?u=${u}`,twitter:`https://twitter.com/intent/tweet?url=${u}`,mail:`mailto:?subject=${encodeURIComponent(this.api.v1.util.string.stripTags(t.get("fields.title")))}&body=${encodeURIComponent(this.api.v1.util.string.stripTags(t.get("fields.subtitle")))}%0D${u}`,linkedin:`https://www.linkedin.com/sharing/share-offsite/?url=${u}`,threads:`https://threads.net/intent/post?text=${u}`,copyLink:`navigator.clipboard.writeText("${p}");`,glimta:`https://glimta.com/unlock?link=${u}`,talandeWebb:"ReachDeck.panel.toggleBar();"},"article"===o){const t=this.api.v1.config.get("page_settings.article.ignoredTags")||[],s=this.api.v1.config.get("page_settings.article.ignoredTagPrefix")||[],a=(e.get("tags")||[]).filter((e=>!t.includes(e))).filter((e=>{for(const t of s)if(e.startsWith(t))return!1;return!0}));i.tagsString=a.toString();let r="";a.forEach(((e,t)=>{r+=`"${e.replace('"',"'")}"`,t<a.length-1&&(r+=", ")})),i.tagsStringCommaSeparated=r;const o=this.api.v1.model.query.getChildrenOfType(e,"byline",!0);if(o){const e=o.map((e=>`"${e.get("fields.firstname")} ${e.get("fields.lastname")}"`)).join(", ");i.bylinesStringCommaSeparated=e}}"article"===o&&e.get("fields.published")&&(i.published=new Date(1e3*parseInt(e.get("fields.published"),10)).toISOString(),i.publishedTimestamp=e.get("fields.published")),i.site=this.api.v1.site.getSite(),i.siteJSON=JSON.stringify(i.site),i["site.domain_no_protocol"]=i.site.domain.split("://").pop(),i.siteAlias=i.site.alias,i.fullUrl=i.site.domain,i[`site_is_${i.siteAlias}`]=!0;const w=this.page.resources;if(!m&&i.is_article&&this.api.v1.config.get("displayReadProgress.active")&&t.get("fields.displayReadProgress")&&(i.readProgress=w.scripts.getProgressReader()),i.siteStylesheetList=s.getSiteStylesWithFallback(i.siteAlias),Sys.logger.debug(`ViewSupport: Will include ${i.siteStylesheetList.length} configured stylesheet(s): "${i.siteStylesheetList.join(", ")}".`),i.siteFiles=w.scripts.getSiteFiles(e,t,i.siteAlias,o,m),i.modules=w.scripts.getModules(e,t,i.siteAlias,o,m),!m){i.analytics=w.analytics.get(),i.widgets={strossle:this.api.v1.config.get("widgets.strossle.strossle_id")},i.consent={cookieconsent:this.api.v1.config.get("consent.cookieconsent.show"),cookieconsent_culture:this.api.v1.config.get("consent.cookieconsent.culture")||"NB"},this.api.v1.config.get("cookieConsent.enabled")&&w.scripts.required.push({url:"/view-resources/public/common/cookieConsent.js",requireDom:!1}),"desktop"===this.api.v1.viewport.getName()&&t.get("fields.style_slidein")&&(i.style_slidein=!0,w.scripts.required.push({url:"/view-resources/public/common/SlideIn/SlideIn.js",requireDom:!1}));const s=this.api.v1.config.get("adEnvironment")||{},a="1"===t.get("fields.hideAds");if(!a&&s&&"adnuntius"===s.name)try{i.adnuntius=l.getAdnuntiusSettings(this.api,e,t,s,i.site)}catch(e){Sys.logger.warn(`[PageData] Failed to prepare Adnuntius ads: ${e.toString()}`)}if(!a&&s&&"google"===s.name)try{i.googleAds=l.getGoogleSettings(this.api,e,t,s,i.site)}catch(e){Sys.logger.warn(`[PageData] Failed to prepare Google ads: ${e.toString()}`)}}if(this.api.v1.util.request.hasQueryParam("fontpreview")&&(i.fontpreview=this.api.v1.util.request.getQueryParam("fontpreview"),i.analytics=null),i.page_settings=this.page.settings.get({pageType:o,socialLinks:i.social}),"article"===o){const s=this.api.v1.config.get("comments_provider.hideCommentsIfPaywall")||!1,a=this.api.v1.properties.get("paywall")||{},r=lab_api.v1.app.mode.isFront()&&a.active&&!a.hasAccess&&s,l=!1===m&&!1===r;if(t.get("fields.showcomments")&&!r){if(this.api.v1.config.get("comments_provider.facebook")){const e=this.api.v1.config.get("comments_provider.facebook.app_id");e&&(i.facebook={display:l,displayPlaceholder:m,appId:e,pageId:n,url:i.fullUrl+("article"===o?`/a/${n}`:"")},i.displayComments=!0)}if(this.api.v1.config.get("comments_provider.disqus")){const e=this.api.v1.config.get("comments_provider.disqus.enable"),t=this.api.v1.config.get("comments_provider.disqus.script");e&&(i.disqus={display:l,displayPlaceholder:m,canonical:f,pageId:n,script:t},i.displayComments=!0)}const t=this.api.v1.config.get("comments_provider.commento");t&&t.enable&&(i.commento={display:l,displayPlaceholder:m,canonical:f,usePageId:t.usePageId,pageId:n,script:t.script,cssOverride:t.cssOverride,descriptionText:t.descriptionText},i.displayComments=!0);const s=lab_api.v1.config.get("comments_provider.hyvor");if(s&&s.websiteId){const t=e.get("fields.published")||0;i.hyvor={display:l,displayPlaceholder:m,websiteId:s.websiteId,pageId:t>1646908200&&n},s.hidePageIdBeforeDate&&t<s.hidePageIdBeforeDate&&(i.hyvor.pageId=""),i.displayComments=!0}const a=lab_api.v1.config.get("comments_provider.ifragasatt");a&&(i.ifragasatt={display:l,displayPlaceholder:m,customerId:a.customer_id,articleId:`article${n}`},i.displayComments=!0)}}i.menus=this.page.menus.get({defaultSection:t.get("fields.defaultsection"),section:t.get("primaryTags.section")}),i.style_definitions=r.getStyleDefinitions(this.api),i.css_build=r.getInlineCSS(this.api),i.contact=this.api.v1.config.get("contact");const F=!!t.get("fields.norobots"),S=t.get("fields.hidefromfp_time"),T=Math.round(a.getTime()/1e3);if(i.norobots=F||S&&S<=T||!1,"article"===o&&this.api.v1.config.get("embeddable.active")){w.scripts.required.push({url:"/view-resources/public/common/embedThis.js",requireDom:!0});const e=this.api.v1.config.get("embeddable.sitelink")||{};i.embeddable={active:!0,display:!!t.get("fields.displayEmbedButton"),isFullContent:this.api.v1.util.request.getQueryString().indexOf("lab_content=full")>-1,sitelink:{prefix:e.prefix,postfix:e.postfix}}}Sys.logger.debug(`ViewSupport: Will include ${w.scripts.required.length} configured script(s): "${w.scripts.required.map((e=>e.url)).join(", ")}".`),w.scripts.required.forEach((e=>{if(!e.placeholderKey&&e.requireDom&&(e.placeholderKey="requireDom"),e.placeholderKey){const{placeholderKey:t}=e;e.placeholderKey={},e.placeholderKey[t]=!0}})),i.siteScriptList=w.scripts.required,i.paywall=this.getPaywallInfo(e,m);const D=new d({pageType:o,canonical:f,isTagpage:y,isTagpageWithFrontpage:v,tagpagePath:b}),C=D.generateSiteData(e),x=D.getStructuredData(e);i.jsonld=JSON.stringify([C,x]);const $=D.getSEOData(e);if(i.seotitle=$.title,i.seodescription=$.description,i.seolanguage=$.language,"article"===o){const t=e.get("fields.sometitle")||e.get("fields.teaserTitle")||e.get("fields.title");t&&(i.sometitle=this.api.v1.util.string.stripTags(t));const s=e.get("fields.somedescription")||e.get("fields.teaserSubtitle")||e.get("fields.subtitle");if(s&&s.length>0)i.somedescription=this.api.v1.util.string.stripTags(s);else{let t=e.get("fields.bodytext")||"";t=this.api.v1.util.string.stripTags(t),i.somedescription=`${t.substring(0,100)} ...`}}else if("front"===o){const t=e.get("fields.someimage");null!=t&&""!==t&&(i.someimage=`${h}/${t}.webp?width=1200&height=630`),i.sometitle=e.get("fields.sometitle")||e.get("fields.name"),i.somedescription=e.get("fields.somedescription")||""}if(i.simplestreamEnabled=lab_api.v1.config.get("contentbox_settings.simplestream")||!1,"mailmojo"===i.device&&this.setDefaultMailmojoData(e,t),"article"===o){const t=lab_api.v1.config.get("page_settings.article.ageWarnings");if(Array.isArray(t)){const i=e.get("fields.published");if(i){const s=this.getAgeWarningItem(i,t);s&&e.setFiltered("ageWarning",s)}}}return i.featureFlags={responsive_mobile_fonts:!lab_api.v1.util.featureFlags.enabled("Disable responsive mobile fonts",o)},i}getAgeWarningItem(e,t){const i=Object.values(t).filter((e=>!!e.years&&!!e.label)).sort(((e,t)=>t.years-e.years)),s=new Date(1e3*e),a=Date.now()-s,r=new Date(a),o=Math.abs(r.getUTCFullYear()-1970);for(const e of i)if(o>=e.years)return e;return null}setDefaultMailmojoData(e,t){const i=lab_api.v1.config.get("lang")||"no";e.setFiltered("lang",i)}getCanonicalUrl(e,t,i,s){const a=e.get("fields.lab_canonical");if(a)return a;if("front"===t){const t=e.get("fields.hostpath");if(t)return`${s}/${"index"===t?"":t}`}return`${s+e.get("fields.published_url")}`}getStaticUrl(e,t,i,s){if("front"===t){const t=lab_api.v1.util.request.getHeader("X-Labrador-404-Referer");if(t)return`${s}${t}`;const i=e.get("fields.hostpath");return i?`${s}/${"index"===i?"":i}`:`${s+e.get("fields.published_url")}`}return`${lab_api.v1.properties.get("site").domain}/a/${i}`}getCustomMetatags(){const e=lab_api.v1.config.get("customMetatags")||[],t=lab_api.v1.config.get("customMetatagsKeyVal")||[],i=[];for(const t of e){const e=Object.keys(t).map((e=>({key:e,value:t[e]})));i.push(e)}for(const e of t)e.length&&i.push(e);return i}getPaywallInfo(e,t){const i=lab_api.v1.properties.get("paywall"),s=!t&&"1"===e.get("fields.paywall");return{enabled:s,settings:i,hasAccess:!s||!i.active||i.hasAccess,hidePaywallOffers:"paywall_loginonly"===this.api.v1.util.request.getQueryParam("lab_opts"),requiredProducts:JSON.stringify(this.api.v1.properties.get("app.paywall.requiredProducts")||[])}}}class p{static parseCss(e,t="filtered.autodata"){const i=e.get(t);if(i&&"object"==typeof i)return[Object.values(i.cssObject||{}).join(" "),i.cssString||"",(i.cssArray||[]).join(" ")].join(" ").trim()}static parseAttributes(e){const t=e.get("filtered.autodata.attributesObject");if(t&&"object"==typeof t)return Object.keys(t).map((e=>({key:e,value:t[e]})))}static parseCustomData(e){const t=e.get("filtered.autodata.custom");if(!t||"object"!=typeof t)return;const i={};for(const e of Object.keys(t))i[e]=Object.keys(t[e]).map((i=>({key:i,value:t[e][i]})));return i}static parseCustomDataFromFeed(e,t){const i=lab_api.v1.config.get(`${t}.autodata.mapping`)||{};if(!i||"object"!=typeof i)return;const s={labels:[]};if(i.labels)for(const t of Object.keys(i.labels))e[i.labels[t]]&&s.labels.push({key:t,value:e[i.labels[t]]});return s}}class u{constructor(e){this.api=e,this.pageData=new c(this.api,new a(this.api))}onReady(e,t){this.pageData.set(e,t),e.setFiltered("autodata_css",p.parseCss(e)),e.setFiltered("autodata_attributes",p.parseAttributes(e)),e.setFiltered("autodata_custom",p.parseCustomData(e))}}class h{constructor(e){this.api=e,this.pageData=new c(this.api,new a(this.api))}onReady(e,t){this.pageData.set(e,t)}}class m{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("contentbox_settings.adnuntiusAd.formats")||[],s=e.get("fields.format"),a=i.filter((e=>e.format===s))[0]||{};if(e.setFiltered("adData",a),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug")||e.get("metadata.isDebug")),!this.api.v1.app.mode.isEditor()){const t=e.parent&&!0===e.parent.get("metadata.hideOnTablet")&&"tablet"===this.api.v1.config.get("xUaDevice");e.setFiltered("hideOnTablet",t)}if(this.api.v1.app.mode.isEditor()){const t=this.api.v1.model.root.getType().replace("page_",""),a=[];i.forEach((e=>{if(e.selectable&&e.selectable.indexOf(t)>-1||e.selectableOn&&!0===e.selectableOn[t])if(e.format===s){const t={...e};t.selected=!0,a.push(t)}else a.push(e)})),e.setFiltered("formatConfigKeys",a)}const r=this.api.v1.config.get("contentbox_settings.adnuntiusAd.label")||"Annonse",o=e.get("fields.label")||r;if(e.setFiltered("label",o),(e.get("metadata.css")||"").includes("sticky")){const t=`top: ${this.api.v1.config.get("contentbox_settings.adnuntiusAd.spacingTop")||120}px;`;e.setFiltered("spacingTop",t)}}}class f{constructor(e){this.api=e}onRender(e){const t=this.api.v1.config.get("contentbox_settings.apsis_submit");t&&e.setFiltered("apsis",t)}}class b{static textElements(e,t){const i={top:[],floating:[],bottom:[],positions:{kicker:""}};return e.get("metadata.showKicker")&&(t||e.get("fields.kicker")||e.get("fields.origin_data_json.teaserKicker")||e.get("fields.origin_data_json.kicker"))&&(e.get("metadata.floatingKicker")?(i.floating.push("kicker"),i.positions.kicker="floating"):e.get("metadata.kickerBelowImage")?(i.bottom.push("kicker"),i.positions.kicker="below"):(i.top.push("kicker"),i.positions.kicker="above")),e.get("metadata.hideTitle")||!t&&!e.get("fields.title")||(e.get("metadata.floatingTitle")?i.floating.push("title"):e.get("metadata.titleAboveImage")?i.top.push("title"):i.bottom.push("title")),!e.get("metadata.hidesubtitle")&&(t||e.get("fields.subtitle")||e.get("fields.origin_data_json.teaserSubtitle"))&&(e.get("metadata.floatingSubtitle")?i.floating.push("subtitle"):e.get("metadata.subtitleAboveImage")?i.top.push("subtitle"):i.bottom.push("subtitle")),i}}class y{constructor(e){this.api=e,this.imageServer=this.api.v1.properties.get("image_server"),this.domain=this.api.v1.site.getSite().domain||this.api.v1.properties.get("customer_front_url")}onReady(e,t){e.setFiltered("layout",b.textElements(t,this.api.v1.app.mode.isEditor()));let i=e.get("fields.published_url")||"";!/^https?/.test(i)&&i&&(i=this.domain+i),e.setFiltered("published_url",i),e.setFiltered("published_url_rss",i.replace(/&/g,"&amp;"))}onRender(e,t){const i=e.get("instance_of")||e.get("fields.origin_data_json.id"),s=e.get("fields.published")||e.get("fields.origin_data_json.published"),a=e.get("fields.origin_data_json.teaserTitle")||t.get("fields.title")||"",r=e.get("fields.origin_data_json.teaserSubtitle")||t.get("fields.subtitle")||"",o=e.get("fields.origin_data_json.published")||e.get("fields.published"),n=e.get("fields.origin_data_json.teaserKicker")||e.get("fields.origin_data_json.kicker")||t.get("fields.kicker"),l=e.get("fields.site_id")||e.get("fields.origin_data_json.site_id");e.setFiltered("published",s),e.setFiltered("title",a),e.setFiltered("kicker",n),e.setFiltered("subtitle",r),e.setFiltered("articleId",i),e.setFiltered("section",e.get("fields.origin_data_json.section_tag")||e.get("fields.section")||""),e.setFiltered("base_url",this.domain),e.setFiltered("published_sitemap",o),e.setFiltered("canonical_url",`${this.getSiteDomain(l)}/a/${i}`),e.setFiltered("tags",e.get("tags")||[]);const d=(new Date).getTime()-1728e5;if(e.setFiltered("articleOutOfDate_sitemap",d>Math.floor(new Date(o).getTime())),!this.api.v1.config.get("showHiddenTagsOnFront")){const t=(this.api.v1.config.get("tagsToHide")||"").split(",").map((e=>e.trim()))||[],i=(e.get("tags")||[]).filter((e=>!t.includes(e)));e.setFiltered("tags",i)}if(l){const t=this.api.v1.site.getSiteById(l);t&&e.setFiltered("site_alias",t.alias)}const g=e.get("fields.origin_data_json.showbylineonfp")||t.get("fields.displayByline")||!1;if(g){const i=t.get("fields.byline")||e.get("fields.origin_data_json.byline"),s=t.get("fields.bylineImage")||e.get("fields.origin_data_json.bylineImage"),a=(e.get("fields.origin_data_json.full_bylines")||e.get("fields.full_bylines_json")||[]).map((e=>({firstname:e.firstname,lastname:e.lastname,imageUrl:e.imageUrl?this.getImageUrl(`${e.imageUrl}&width=30&height=30`):""})));a.length||!i&&!s||a.push({firstname:i,lastname:"",imageUrl:s?this.getImageUrl(`${s}&width=30&height=30`):""}),e.setFiltered("bylines",a),s&&e.setFiltered("bylineImage",`${s}&width=30&height=30`)}e.setFiltered("displayByline",g);let c=e.get("fields.origin_data_json.paywall")||e.get("fields.paywall")||!1;if(c=1===c||"1"===c||!0===c||null,c){const i={text:{content:"Pluss"},icon:{content:"fi-plus"},display:!0,displayInNewsletter:!0,...this.api.v1.config.get("paywall.label")};if(i.display){i.layout={noImage:!0,float:null};const s=this.api.v1.model.query.getChildOfType(e,"image")||this.api.v1.model.query.getChildOfType(e,"graphic");if(s){const e=this.api.v1.view.getView(s,t.getViewport());i.layout.float=e.get("fields.float")||null,i.layout.noImage=!!t.get("metadata.hideimage")}e.setFiltered("paywallLabel",i)}}else e.setFiltered("paywallLabel",null);e.setFiltered("paywall",c);const u=e.get("metadata.sectionPlacement")||"floating";e.setFiltered("sectionPlacement.floating","floating"===u),e.setFiltered("sectionPlacement.underImage","underImage"===u),e.setFiltered("sectionPlacement.underText","underText"===u),e.setFiltered("articleWidth",t.getPixelWidth()),e.setFiltered("autodata_css",p.parseCss(e)),e.setFiltered("autodata_content_css",p.parseCss(e,"filtered.autodata_content")),e.setFiltered("autodata_attributes",p.parseAttributes(e)),e.setFiltered("autodata_custom",p.parseCustomData(e))}onId(e){const t=e.get("fields.published");if(t){const i=new Date(t).getTime();if(i>(new Date).getTime()){let s=this.api.v1.model.query.getParentOfType(e,"row");if(!s)return;const a=this.api.v1.model.query.getParentOfType(s,"row");a&&(s=a);const r=s.get("metadata.visibleAfterDate")||new Date(t).toISOString();new Date(r).getTime()<=i&&(s.set("metadata.visibleAfterDate",new Date(t).toISOString()),this.api.v1.model.highlight.message(s,"Publish-date updated for row"))}}}getSiteDomain(e){if(!e)return"";const t=this.api.v1.site.getSiteById(e);return t?t.domain:""}getImageUrl(e){return e?e.startsWith("http")?e:this.imageServer+e:""}}class v{constructor(e){this.api=e}onViewHelper(e){const t=e.get("fields.site_id")||null,i=e.get("fields.articleCount")||6,s=`${(new n).formattedUtcDate(new Date,"Y-m-d")}T00:00:00Z`,a=`${this.api.v1.properties.get("front_api_url")}/api/v1/article/?`,r={orderBy:"calendar_start_date",order:"asc",site_id:t,limit:i,htmlText:1},o={visibility_status:"P",published:"[*%20NOW]",calendar_start_date:`[${s}%20TO%20*]`},l=[];for(const e in r)r[e]&&l.push(`${e}=${r[e]}`);const d=[];for(const e in o)o[e]&&d.push(`${e}:${o[e]}`);l.push(`query=${d.join("%20AND%20")}`);const g=a+l.join("&");e.setFiltered("url",g)}onRender(e,t){const i=t.get("external"),s=e.get("fields.site_id")||"",a=e.get("fields.displayImage"),r=e.get("fields.displayTitle")||null,o=e.get("fields.displaySubtitle"),n=this.api.v1.properties.get("image_server"),l=this.api.v1.config.get("contentbox_settings.articleCalendar.imageAspectRatio")||this.api.v1.config.get("image.defaultAspectRatio"),d=["width=420",`height=${Math.floor(420*l)}`,`format=${this.api.v1.image.getPreferredImageFormat()}`];if(this.api.v1.app.mode.isEditor()){const t={displayImage:!!a,displayTitle:null===r||!!r,displaySubtitle:!!o},i=[{value:"",name:"Any site"}];this.api.v1.site.getSites().forEach((e=>{i.push({value:e.id,name:e.display_name,selected:s&&e.id===parseInt(s,10)})})),t.site_ids=i,e.setFiltered("options",t)}if(i){const t=[];i.result.forEach((e=>{const i={url:e.published_url};r&&(i.title=e.teaserTitle||e.title),o&&(i.subtitle=e.teaserSubtitle||e.subtitle),a&&e.frontCropUrl&&(i.calendarimage=`${n}/${e.frontCropUrl}&${d.join("&")}`),t.push(i)})),e.setFiltered("data",t)}}}class _{constructor(e){this.api=e,this.ignoredTags=this.api.v1.config.get("page_settings.article.ignoredTags")||[],this.ignoredTagPrefix=this.api.v1.config.get("page_settings.article.ignoredTagPrefix")||[],this.adminIgnoredTags=this.api.v1.config.get("showHiddenTagsOnArticle")?[]:(this.api.v1.config.get("tagsToHide")||"").split(",").map((e=>e.trim()))}onRender(e,t){const i=[...new Set([...this.ignoredTags,...this.adminIgnoredTags])],s=(this.api.v1.model.query.getRootModel().get("tags")||[]).filter((e=>!i.includes(e))).filter((e=>{for(const t of this.ignoredTagPrefix)if(e.startsWith(t))return!1;return!0}));e.setFiltered("tags",s),e.setFiltered("tagPagePath",this.api.v1.config.get("tagPagePath")||"/tag/")}}class k{constructor(e){this.api=e}onInserted(e){e.get("metadata.hidecaption")&&(e.set("fields.displayCaption",!1,{save:!1}),e.set("metadata.hidecaption",null,{save:!1}))}onRender(e,t){const i=b.textElements(t,this.api.v1.app.mode.isEditor());if(e.setFiltered("layout",i),e.setFiltered("hasFloatingText",i.floating.length>0),this.api.v1.app.mode.isFront()){const t=e.get("fields.kicker");e.setFiltered("hideKicker",!t||t.includes("Click to add kicker"))}}async onChildAdded(e,t){"image"===t.getType()&&this.api.v1.article.frontcrop.get().then((e=>{if(e)return;const i=t.get("instance_of");i?this.setFrontCrop(i):this.api.v1.model.bindings.bind(t,"instance_of",((e,t,i)=>{this.setFrontCrop(i)}))})).catch((e=>{Sys.logger.warn(`[ArticleHeader] Failed to get front-crop: "${e.toString()}"`)}))}setFrontCrop(e){const t={type:"image",contentdata:{instance_of:e,fields:{croph:100,cropw:100,x:0,y:0}}};this.api.v1.article.frontcrop.set({pano:t,height:t}).then((()=>{Sys.logger.debug("[ArticleHeader] Front-crop successfully set.")})).catch((e=>{Sys.logger.warn(`[ArticleHeader] Failed to set front-crop: "${e.toString()}"`)}))}}class w{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor()}onRender(e,t){const i=t.getAbsoluteGridWidths(),s=e.get("fields.columnsDesktop")||this.getFallbackColumns(i.desktop||12),a=e.get("fields.columnsMobile")||1;if(e.setFiltered("columns",{desktop:s,mobile:a}),!this.isEditor)return;const r=e.get("fields.layout"),o=[{value:"default",label:"Horizontal",selected:"default"===r},{value:"vertical",label:"Vertical",selected:"vertical"===r}],n=e.get("fields.imageLayout"),l=[{value:"full",label:"100% width",selected:"full"===n},{value:"left",label:"Align Left",selected:"left"===n},{value:"right",label:"Align Right",selected:"right"===n}];e.setFiltered("layoutOptions",o),e.setFiltered("imageLayoutOptions",l)}getFallbackColumns(e){return e>=10?4:e>=7?3:e>=5?2:1}}class F{constructor(e){this.api=e}onRender(e,t){const i=lab_api.v1.config.get("lang")||"no",s={publishedLabel:"Publisert",unpublishedLabel:"(upublisert) Opprettet",modifiedLabel:"Sist oppdatert",unifiedLabel:"",languageCode:i,niceDates:!1,dateFormat:"l d. F Y - H:i",dateFormatPrependZero:!0,timeFormatPrependZero:!0,template:"{{dddd}} {{DD}}. {{MMMM}} {{YYYY}} - {{HH}}:{{mm}}",useOldFormat:!1};"en"===i&&(s.publishedLabel="Published",s.unpublishedLabel="(unpublished) Created",s.modifiedLabel="Last updated",s.languageCode="en");const a=this.api.v1.config.get("contentbox_settings.articleMeta.date");if(a){for(const e in a)e&&void 0!==s[e]&&(s[e]=a[e]);"dateFormat"in a&&!("template"in a)&&(s.useOldFormat=!0)}const r=new n(s.languageCode);let o=s.publishedLabel,l=e.get("fields.published");const d=e.get("fields.modified")>=l?e.get("fields.modified"):null;l||(o=s.unpublishedLabel,l=e.get("fields.created"));let g=this.api.v1.config.get("contentbox_settings.articleMeta.hideModifiedDate");g||(g=e.get("fields.hidePublishedDate"));const c=e.get("fields.hidePublishedDate"),p=new Date(1e3*l),u=d?new Date(1e3*d):null,h={isoDate:p.toISOString(),label:o,timestamp:l,hide:c,formatted:""},m={isoDate:u?u.toISOString():"",label:s.modifiedLabel,timestamp:d,hide:g,formatted:""},f={hide:!0};this.api.v1.config.get("contentbox_settings.articleMeta.displayUnifiedDate")&&(f.hide=!1,f.isoDate=(u||p).toISOString(),f.timestamp=d||l,f.label=s.unifiedLabel,f.formatted="",h.hide=!0,m.hide=!0),s.niceDates?(h.hide||(h.formatted=r.timestampToNiceDate(r.toTimestamp(p))),u&&!m.hide&&(m.formatted=r.timestampToNiceDate(r.toTimestamp(u))),f.hide||(f.formatted=r.timestampToNiceDate(r.toTimestamp(u||p)))):s.useOldFormat?(h.hide||(h.formatted=r.formattedUtcDate(p,s.dateFormat,s.dateFormatPrependZero,s.timeFormatPrependZero)),u&&!m.hide&&(m.formatted=r.formattedUtcDate(u,s.dateFormat,s.dateFormatPrependZero,s.timeFormatPrependZero)),f.hide||(f.formatted=r.formattedUtcDate(u||p,s.dateFormat,s.dateFormatPrependZero,s.timeFormatPrependZero))):(h.hide||(h.formatted=r.utcFormat(p,s.template)),u&&!m.hide&&(m.formatted=r.utcFormat(u,s.template)),f.hide||(f.formatted=r.utcFormat(u||p,s.template))),e.setFiltered("date",{published:h,modified:m,unified:f});const b=e.get("fields.readTime")||.5,y=this.api.v1.config.get("displayReadTime.label")||"Read-time";e.setFiltered("readTime",b<1?"< 1 min":`${b} min`),e.setFiltered("readTimeLabel",y)}onInserted(e){}}class S{constructor(e){this.api=e,this.rootModel=this.api.v1.model.query.getRootModel(),this.isEditor=this.api.v1.app.mode.isEditor(),this.boundIds={},this.config=this.api.v1.config.get("contentbox_settings.articlesByTag")||{niceDates:!0,dateFormat:"{{ HH }}:{{ mm }} - {{ DD }}.{{ MM }}.{{ YYYY }}"},this.preferredImageFormat=lab_api.v1.image.getPreferredImageFormat()}onViewHelper(e,t){const i={image:!1,title:!0,subtitle:!0,published:!1},s=[],a=e.get("fields.displayOptions_json")||{};for(const e of Object.keys(i))void 0!==a[e]&&(i[e]=!!a[e]);const r=e.get("fields.query_json")||{},o=void 0===r.site_id?this.api.v1.site.getSite().id:r.site_id,n=lab_api.v1.config.get("contentbox_settings.articlesByTag.imageAspectRatio")||lab_api.v1.config.get("image.defaultAspectRatio"),l=["width=200",`height=${Math.floor(200*n)}`];this.preferredImageFormat&&"jpg"!==this.preferredImageFormat&&l.push(`format=${this.preferredImageFormat}`),e.setFiltered("site_id",o),e.setFiltered("displayOptions",i),e.setFiltered("imageServer",this.api.v1.properties.get("image_server")),e.setFiltered("imgArgs",l.join("&")),e.setFiltered("orderBy","published"),e.setFiltered("tagPagePath",lab_api.v1.config.get("tagPagePath")||"/tag/"),e.setFiltered("limit",r.limit||10);const d=(e,t,i)=>{const s=[];Array.isArray(t)&&t.forEach((e=>{let t=e;t=t.replace(/([\(\)\s+])/g,"\\$1"),t=t.toLowerCase(),s.push(t)}));const a=this.rootModel.get("id");let r;if(e.get("fields.useApiQuery")&&e.get("fields.apiQuery")){const t=e.get("fields.apiQuery").replace(/\b(AND|OR|NOT)\b/g,"__$1__").toLowerCase().replace(/__and__/g,"AND").replace(/__or__/g,"OR").replace(/__not__/g,"NOT");r=t.length?`(${t}) AND published:[* NOW] AND NOT id:${a}`:`published:[* NOW] AND NOT id:${a}`,r=r.replace(/""+/g,'"')}else r=s.length?`(tag:"${s.join('" OR tag:"')}") AND published:[* NOW] AND NOT id:${a}`:`published:[* NOW] AND NOT id:${a}`,r=r.replace(/""+/g,'"');"edit"===i&&(e.set("fields.query",r,{save:!1}),e.setFiltered("query",encodeURIComponent(r)),e.set("fields.selectedTags_json",t,{save:!1})),"published"===i&&(e.setFiltered("query",encodeURIComponent(r)),e.set("fields.selectedTags_json",t,{save:!1}))};if(!this.isEditor){e.setFiltered("lazyloadImages",lab_api.v1.config.get("imageLoading.lazy")||!1);const t=this.rootModel.get("primaryTags.section");let i=[];i=(this.rootModel.get("tags")||[]).filter((e=>e!==t)),e.get("fields.usePageTags")?d(e,i,"published"):e.get("fields.useApiQuery")&&e.get("fields.apiQuery")?d(e,"","published"):e.setFiltered("query",encodeURIComponent(e.get("fields.query")))}if(this.isEditor){for(const e of Object.keys(i))s.push({name:e,value:i[e]});const t=[{value:"",name:"Any site"}];this.api.v1.site.getSites().forEach((e=>{t.push({value:e.id,name:e.display_name,selected:e.id==o})})),e.setFiltered("siteOptions",t),e.setFiltered("editDisplayOptions",s);const a=()=>{if(e.get("fields.useApiQuery"))d(e,"","edit");else{let t=[];if(e.get("fields.usePageTags")){const e=this.rootModel.get("primaryTags.section");t=(this.rootModel.get("tags")||[]).filter((t=>t!==e))}else(e.get("fields.tagsString")||"").split(",").forEach((e=>{const i=e.trim();i&&t.push(i)}));d(e,t,"edit")}},r=()=>{e.set("fields.usePageTags",!1),a()},n=e.getGuid();this.boundIds[n]||(this.boundIds[n]=!0,this.api.v1.model.bindings.bind(this.rootModel,"tags",a),this.api.v1.model.bindings.bind(e,"fields.usePageTags",a),this.api.v1.model.bindings.bind(e,"fields.usePageTags",a),this.api.v1.model.bindings.bind(e,"fields.tagsString",r)),a()}}onRender(e,t){const i=this.api.v1.config.get("lang")||"no",s=new n(i),a=t.get("external"),r=[];a&&a.result&&a.result.forEach((e=>{if("article"===e.type){const t=e.published||null,i=new Date(t);r.push({title:e.title,subtitle:e.subtitle,published_url:e.published_url,frontCropUrl:e.frontCropUrl,published:t,formatted:t&&this.config.niceDates?s.timestampToNiceDate(s.toTimestamp(i)):s.format(i,this.config.dateFormat)})}})),e.setFiltered("templateData",r)}onSettingsPanel(e,t,i){return{onDisplay:e=>{const t=e.markup.querySelector(".advancedToggle"),i=e.markup.querySelector(".advanced");t&&i&&t.addEventListener("click",(e=>{const s=i.classList.contains("lab-hidden");i.classList.toggle("lab-hidden"),s?(t.classList.remove("labicon-pluss_slim"),t.classList.add("labicon-minus_slim")):(t.classList.remove("labicon-minus_slim"),t.classList.add("labicon-pluss_slim"))}),!1)}}}}class T{constructor(e){this.api=e,this.config=this.api.v1.config.get("contentbox_settings.articlescroller")||{sources:{all:{src:"${front_api_url}/api/v1/article/?orderBy=published&query=visibility_status:P%20AND%20published:[*%20NOW]%20AND%20showonfp:1&site_id={{ data.site_id }}&limit={{ data.articleCount }}",data_type:"labrador",is_default:!0}},imageAspectRatio:.5,visibleArticleCount:4,visibleArticleCountMobile:1},this.preferredImageFormat=lab_api.v1.image.getPreferredImageFormat(),this.isEditor=this.api.v1.app.mode.isEditor(),this.sourceList=this.getSourceList(),this.domain=this.api.v1.site.getSite().domain||this.api.v1.properties.get("customer_front_url")}onViewHelper(e){const t=e.get("fields.source")||this.getDefaultSource(this.sourceList),i=e.get("fields.site_id"),s=e.get("fields.articleCount")||10;if(this.sourceList[t]&&this.sourceList[t].src){let a=null;if(this.sourceList[t].defaultsiteAlias){const e=this.api.v1.site.getSite(this.sourceList[t].defaultsiteAlias);e&&(a=e.id)}const r=e.get("fields.dateLimitFrom"),o=e.get("fields.dateLimitTo"),l=(new n).formattedUtcDate(new Date,"Y-m-d");let d="";"today"===r&&(d=`calendar_start_date:[${l}T00:00:00Z%20TO%20*]%20AND%20`),"today"===o&&(d+=`calendar_end_date:[*%20TO%20${l}T23:59:59Z]%20AND%20`);const g={site_id:i||a,front_api_url:this.api.v1.properties.get("front_api_url"),articleCount:s,dateQuery:d},c=Mustache.render(this.sourceList[t].src,{data:g});e.setFiltered("url",c)}else Sys.logger.warning(`ArticleScroller: Missing config for source "${t}". Cannot fetch data. Check config.`)}onRender(e,t){const i=e.get("fields.source")||this.getDefaultSource(this.sourceList),s={text:{content:"Pluss"},icon:{content:"fi-plus"},display:!0,...this.api.v1.config.get("paywall.label")};s.display&&e.setFiltered("paywallLabel",s);let a=e.get("fields.visibleArticleCount")||this.api.v1.config.get("contentbox_settings.articlescroller.visibleArticleCount")||4;const r=e.get("fields.visibleArticleCountMobile")||this.api.v1.config.get("contentbox_settings.articlescroller.visibleArticleCountMobile")||2,o=a,n=r,l=this.config.restrictHeight||!1,d=!!e.get("fields.hideImages"),g=!!e.get("fields.showAuthor"),c=!!e.get("fields.hideNavigation"),p=e.get("fields.transitionDuration")||4e3,u=(p/1e3/100*(e.get("fields.transitionStep")||15)).toFixed(2);"mobile"===t.viewport&&(a=r);let h=this.api.v1.view.getPixelDensityFactor();t.get("metadata.hasFullWidth")&&(h+=.2);const m={};m.aspectRatio=e.get("fields.aspectRatio")||this.api.v1.config.get("contentbox_settings.articlescroller.imageAspectRatio")||this.api.v1.config.get("image.defaultAspectRatio"),m.width=Math.ceil(this.api.v1.viewport.getWidth(t.viewport)/a),m.height=Math.floor(m.width*m.aspectRatio);const f=t.get("external"),b=e.get("fields.articleCount")||10,y=this.config.externalMappers||{},v=this.sourceList[i]||{};let _=this.mapExternalData(f,v.data_type,{aspectRatio:m.aspectRatio,imageServer:this.api.v1.properties.get("image_server"),width:Math.floor(m.width*h),height:Math.floor(m.height*h),baseUrl:v.baseUrl||"",hideImages:d,showAuthor:g},y);if(Array.isArray(_)&&_.length>0&&(_=_.slice(0,b)),a>_.length&&(a=_.length),a<1&&(a=1),e.setFiltered("useNavigation",!c&&_.length>a),e.setFiltered("visibleArticleCount",a),e.setFiltered("maxVisibleArticleCount",o),e.setFiltered("maxVisibleArticleCountMobile",n),e.setFiltered("restrictHeight",l),e.setFiltered("hideImages",d),e.setFiltered("showAuthor",g),e.setFiltered("transitionDuration",p),e.setFiltered("transitionStep",u),e.setFiltered("data",_),e.setFiltered("width",m.width),e.setFiltered("height",m.height),e.setFiltered("labels",this.config.labels||{buttonLeft:"Rull til venstre",buttonRight:"Rull til høyre"}),this.isEditor&&e.setFiltered("transitionDurationSeconds",p/1e3),this.isEditor){if(v.src){const t={},s=[];for(const e of Object.keys(this.sourceList))s.push({value:e,selected:e===i});t.sources=s;const a=[{value:"",name:"Any site"}],r=parseInt(e.get("fields.site_id")||this.getSiteIdFromAlias(i),10);this.api.v1.site.getSites().forEach((e=>{a.push({value:e.id,name:e.display_name,selected:e.id===r})})),t.site_ids=a;const o=e.get("fields.dateLimitFrom"),n=e.get("fields.dateLimitTo");t.dateLimit={from:[{value:"today",name:"Today",selected:"today"===o}],to:[{value:"today",name:"Today",selected:"today"===n}]};const l=e.get("fields.layoutAlign");t.layout={align:[{value:"left",name:"Align Left",selected:"left"===l},{value:"centered",name:"Align centered",selected:"centered"===l},{value:"right",name:"Align right",selected:"right"===l}]};const d=this.api.v1.config.get("contentbox_settings.articlescroller.layout")||!1;d&&d.forEach((e=>{e&&void 0!==e.value&&(e.selected=e.value===l,e.value===l?e.selected=!0:e.selected=!1),t.layout.align.push(e)})),t.aspectRatio=m.aspectRatio,e.setFiltered("options",t)}}else e.setFiltered("lazyloadImages",this.api.v1.config.get("imageLoading.lazy")||!1)}getSourceList(){const e={};for(const t of Object.keys(this.config.sources||{}))e[t]=this.config.sources[t];const t=this.api.v1.config.get("feeds")||{};for(const i of Object.keys(t))if("json"===t[i].format&&t[i].labrador_json){let s;try{s=new URL(t[i].url)}catch(e){s=null}const a=s?s.origin:this.domain;e[i]={src:t[i].url,data_type:"labrador_json",is_default:!1,baseUrl:a}}return e}getDefaultSource(e){for(const t of Object.keys(e))if(e[t].is_default)return t;const[t=null]=Object.keys(e)||[];return t}getSiteIdFromAlias(e){if(this.sourceList[e].defaultsiteAlias){const t=this.api.v1.site.getSite(this.sourceList[e].defaultsiteAlias);if(t)return t.id}return null}mapExternalData(e,t,i,s){switch(t){case"ntb":return this.mapNtb(e,i);case"advokatjobb":return this.mapAdvokatjobb(e,i);case"labrador_json":return this.mapLabradorJson(e,i);case"labrador_compliant":return this.mapLabradorCompliant(e,i);default:try{if(Object.keys(s).includes(t)){const a=s[t].split(".");let r=window;for(let e=0;e<a.length;e+=1)r=r[a[e]];let o=null;if(r&&(o=r(e,i),o))return o}}catch(e){Sys.logger.warning("Faulty extraMapper function.")}return this.mapLabrador(e,i)}}mapNtb(e,t){const i=[];return e.releases?(e.releases.forEach((e=>{let s=!1,a=null;!t.hideImages&&e.images.length&&(s=e.images[0].thumbnail_16_9||!1),e.logos.length&&(a=e.logos[0].thumbnail_original||!1),t.hideImages||s||!e.logos.length||(s=e.logos[0].thumbnail_16_9||!1);const r={url:`https://www.ntbinfo.no${e.url}`,title:e.title,subtitle:e.leadtext,image:s,iconImage:a};i.push(r)})),i):i}mapAdvokatjobb(e,t){const i=[];return e.Jobs?(e.Jobs.forEach((e=>{let s=!1,a="";e.Company&&(!t.hideImages&&e.Company.Logo&&(s=t.baseUrl+e.Company.Logo),e.Company.Name&&(a=`${e.Company.Name} - `));const r={url:t.baseUrl+e.Url,title:a+e.Title,subtitle:`${e.Location} - ${e.DueDate}`,image:s,iconImage:null};i.push(r)})),i):i}mapLabradorJson(e,t){const i=[];if(!e||!e.result)return i;const s=[`width=${t.width}`,`height=${t.height}`];return e.result.forEach((e=>{const a=p.parseCustomDataFromFeed(e,"contentbox_settings.articlescroller");let r="";e.url&&(r=0===e.url.indexOf("http")||0===e.url.indexOf("//")?e.url:t.baseUrl+e.url);const o={url:r,title:e.teaserTitle?e.teaserTitle:e.title,kicker:e.kicker||e.teaserKicker||"",subtitle:e.teaserSubtitle?e.teaserSubtitle:e.description,image:!(t.hideImages||!e.images||!e.images.length)&&`${e.images[0].url}&${s.join("&")}`,autodata:a||"",section:e.section||"",paywall:!!e.paywall,author:e.byline||""};i.push(o)})),i}mapLabrador(e,t){const i=[];if(!e||!e.result)return i;const s=[`width=${t.width}`,`height=${t.height}`];return this.preferredImageFormat&&"jpg"!==this.preferredImageFormat&&s.push(`format=${this.preferredImageFormat}`),e.result.forEach((e=>{const a=p.parseCustomDataFromFeed(e,"contentbox_settings.articlescroller"),r={url:e.siteDomain+e.published_url,title:e.title,kicker:e.kicker||e.teaserKicker||"",subtitle:e.subtitle,image:!(t.hideImages||!e.frontCropUrl)&&`${t.imageServer}/${e.frontCropUrl}&${s.join("&")}`,autodata:a||"",section:e.section||"",paywall:!!e.paywall,author:e.byline||""};i.push(r)})),i}mapLabradorCompliant(e,t){const i=[];if(!e||!e.result)return i;const s=[`width=${t.width}`,`height=${t.height}`];return e.result.forEach((e=>{let a=!1;!t.hideImages&&e.images&&Array.isArray(e.images)&&e.images.length>0&&(a=`${t.imageServer}/?imageUrl=${e.images[0].url}&${s.join("&")}`);const r={url:e.url,title:e.title,kicker:e.kicker||"",subtitle:e.subtitle,section:e.section||"",image:a,paywall:!!e.paywall,author:e.byline||""};i.push(r)})),i}}class D{static defaultLineIndex=3;static filterBodytext(e,t){let i=lab_api.v1.config.get("paywall.bodytext.lineCount");null!==i&&!1!==i||(i=this.defaultLineIndex);const s=e.get("filtered.lineData");let{bodytext:a}=s;const r=s.indexRegister.reverse();return r.length<=i&&(i=r.length-1),r[i]&&(a=a.substring(0,r[i].charIndex)),a}}class C{constructor(e){this.api=e,this.isFront=this.api.v1.app.mode.isFront(),this.internal=this.api.v1.properties.get("paywall")||{};const t=this.api.v1.config.get("paywall")||{};this.provider=t.provider||"internal",this.displaySalesPosters=!1!==t.displaySalesPosters}onRender(e,t){const i={displaySalesPosters:this.displaySalesPosters,isInternal:"internal"===this.provider&&this.internal.active,active:this.isFront&&("internal"===this.provider?this.internal.active:!!e.get("fields.paywall")),access:!("internal"!==this.provider||!this.internal.active)&&this.internal.hasAccess,provider:this.provider,intro:"internal"!==this.provider?D.filterBodytext(e,t):void 0,bodytext:"internal"!==this.provider?e.get("filtered.bodytext"):void 0};i.active&&!i.access&&("internal"===this.provider?e.setFiltered("bodytext",D.filterBodytext(e,t)):e.setFiltered("bodytext","")),e.setFiltered("paywall",i)}onRendered(e,t){if(!this.isFront){const i=t.getMarkup();if(i.children.length&&"P"!==i.children[i.children.length-1].tagName){const e=document.createElement("p");i.appendChild(e)}this.markCustomIndex(e.getPersistentChildren())}}markCustomIndex(e){for(const t of e){const e=t.getRaw("metadata.bodyTextIndex")||{};Object.values(e.vp||{}).filter((e=>Number.isInteger(e))).length>1&&this.markCustomIndexForModel(t)}}markCustomIndexForModel(e){for(const t of this.api.v1.viewport.getActive()){const i=this.api.v1.view.getView(e,t);if(!i.getExtraElement("customIndexElement")){const t=i.setExtraElement("customIndexElement",this.getCustomIndexElement(e,i));i.getMarkup().appendChild(t)}}}getCustomIndexElement(e,t){const i=document.createElement("span"),s=i=>{i&&(i.stopPropagation(),i.preventDefault()),this.removeCustomIndexElement(e),e.getParent()&&this.api.v1.model.addToRedrawQueue(e.getParent()),e.set("metadata.bodyTextIndex",void 0,{viewport:"mobile"}),this.api.v1.viewport.align(e,t)};i.addEventListener("click",s,!1),i.classList.add("labicon-line_index","is-customindex"),i.setAttribute("title",`${e.getType()} has custom placement. Click to remove on mobile`);const a=(t,r,o)=>{t.getParent()&&"bodytext"!==t.getParent().getType()&&(s(),i.remove(),this.api.v1.model.bindings.unbind(e,"path",a))};return this.api.v1.model.bindings.bind(e,"path",a),i}removeCustomIndexElement(e){for(const t of this.api.v1.view.getViews(e))t.unsetExtraElement("customIndexElement")}}class x{constructor(e){this.api=e}onId(e){const t=lab_api.v1.user.getField("favouriteBylineIds")||[],i=e.get("instance_of");i&&!t.includes(i)&&(t.unshift(i),lab_api.v1.user.setField("favouriteBylineIds",t.slice(0,5)))}onReady(e,t){const i=this.api.v1.model.query.getChildOfType(e,"image");i&&i.get("fields.width")&&i.set("fields.width",null,{save:!1,undoable:!1})}onRender(e,t){const i=this.api.v1.app.mode.isEditor(),s=this.api.v1.config.get("contentbox_settings.byline")||{},a=s.template||[],r={public_email:t.get("fields.public_email"),public_url:t.get("fields.public_url"),public_phone:t.get("fields.public_phone"),firstname:t.get("fields.firstname"),lastname:t.get("fields.lastname"),description:t.get("fields.description"),description2:t.get("fields.description2")};i||(r.firstname&&r.firstname.match(/^byline first name$/i)&&(r.firstname=""),r.lastname&&r.lastname.match(/^byline last name$/i)&&(r.lastname=""));const o={items:[],imageAbove:!!s.imageAbove,imageBelow:!s.imageAbove&&!!s.imageBelow};a.forEach((e=>{const t={url:null,parts:[]};if((e.keys||[]).forEach((e=>{if(r[e]&&r[e]!==`Click to edit ${e}`||i){let i,a=r[e];"description"===e&&s.enableDescriptionLength&&r[e]&&r[e].length>=s.descriptionLength&&(i=r[e],a=`${r[e].substring(0,s.descriptionLength)}...`),t.parts.push({key:e,value:a,title:i})}})),e.url){Array.isArray(e.url)||(e.url=[e.url]);for(let i of Object.keys(e.url))if(i=e.url[i],r[i]){let e=r[i];"public_email"===i&&(e=`mailto:${e}`),t.url=e;break}}t.parts.length&&o.items.push(t)})),e.setFiltered("default_color",s.default_color||""),e.setFiltered("data",o)}}class ${constructor(e){this.api=e,this.dateTimeHelper=new n(this.api.v1.config.get("lang")),this.sources={disqus_most_popular:{source:"disqus",url:`${lab_api.v1.properties.get("integration_url")}/feed/disqus/?site=${lab_api.v1.properties.get("site.alias")}&action=popular`,name:"Most commented articles",description:""},hyvor_most_popular:{source:"hyvor",url:`${lab_api.v1.properties.get("integration_url")}/feed/hyvor/?site=${lab_api.v1.properties.get("site.alias")}&action=popular`,name:"Most commented articles",description:""},hyvor_recent:{source:"hyvor",url:`${lab_api.v1.properties.get("integration_url")}/feed/hyvor/?site=${lab_api.v1.properties.get("site.alias")}&action=recent`,name:"Recent comments",description:""}}}getSourceConfig(e,t){const i=lab_api.v1.config.get("comments_provider")||{},s=Object.keys(i).shift();let a;a="hyvor"===s?"hyvor_most_popular":"disqus_most_popular";const r=e.get("fields.source")||a,o=e.get("fields.title"),n=e.get("fields.description"),l=Math.min(parseInt(e.get("fields.limit")||"5",10),30),d=(lab_api.v1.config.get("contentbox_settings.comments.sources")||[]).filter((e=>void 0!==this.sources[e.type]&&this.sources[e.type].source===s)),g=lab_api.v1.app.mode.isEditor();if(!d.length)return Sys.logger.warning(`comments: Missing required config "contentbox_settings.comments.sources". Options (type): ${Object.keys(this.sources).join(", ")}`),g&&e.setFiltered("error","Missing required source(s)."),null;const c={...this.sources[r],...d.filter((e=>e.type===r)).pop()};return c.url+=`&limit=${l}`,o&&(c.name=o),n&&(c.description=n),c}onViewHelper(e,t){const i=this.getSourceConfig(e,t);i&&e.setFiltered("url",i.url)}onRender(e,t){const i=this.getSourceConfig(e,t);if(!i)return;const s=lab_api.v1.app.mode.isEditor(),a=lab_api.v1.config.get("comments_provider")||{},r=Object.keys(a).shift(),o="hyvor"===r?"hyvor_most_popular":"disqus_most_popular",n=e.get("fields.source")||o,l=e.get("fields.maxCharLength"),d=Math.min(parseInt(e.get("fields.limit")||"5",10),30),g=t.get("external"),c=g&&"string"==typeof g;c?(e.setFiltered("error","Error fetching data"),Sys.logger.warn(`Comments: Error fetching data from url: ${i.url}`)):e.setFiltered("error",null);const p=e=>{const t=e||"";return l?`${t.substring(0,l)} ${t.length>l?"...":""}`:t};if(g&&!c){let t=g;if("disqus_most_popular"===i.type&&(t=g.response.map((e=>({link:e.link,title:p(e.title)})))),"hyvor_most_popular"===i.type&&(t=g.data.map((e=>({link:e.url,title:p(e.title)})))),"hyvor_recent"===i.type){const e=i.items||{},s=e.date||{};t=g.data.map((t=>t.page&&t.page.url?{link:`${t.page.url}?ht-comment-id=${t.id}`,title:(e.titlePrefix||"")+p(t.page.title),user:t.user?t.user.name:"",date:this.dateTimeHelper.format(new Date(1e3*t.created_at),s.template||"")}:{}))}e.setFiltered("data",t)}for(const t of Object.keys(this.sources))e.setFiltered(`is_${t}`,t===n);if(e.setFiltered("url",i.url),e.setFiltered("source",i),!s)return;const u=(lab_api.v1.config.get("contentbox_settings.comments.sources")||[]).filter((e=>void 0!==this.sources[e.type]&&this.sources[e.type].source===r)).map((e=>({name:e.type,selected:e.type===n})));e.setFiltered("sourceList",u),e.setFiltered("limit",d)}}class I{static run(e){const t=e.options||lab_api.v1.config.get(e.configPath)||{},i=lab_api.v1.util.object.merge({kicker:null,kicker_editable:!1,expandable:{mobile:!0,desktop:!0},collapsable:{mobile:!0,desktop:!0},collapsedState:{mobile:!0,desktop:!1},needJs:!1,style:"fade"},t),s=[`style-${i.style}`];for(const e in i.expandable)i.expandable[e]&&s.push(`expandable-${e}`);for(const e in i.collapsable)i.collapsable[e]&&s.push(`collapsable-${e}`);return i.needJs=s.length>0,i.cssString=s.join(" "),i}}class M{constructor(e){this.api=e}onRender(e,t){e.setFiltered("options",I.run({configPath:"contentbox_settings.factbox"})),e.setFiltered("noContent",lab_api.v1.app.mode.isFront()&&!e.get("fields.title")&&!e.get("fields.bodytext"))}}class A{constructor(e){this.api=e}onSettingsPanel(){function e(e,t){const i=lab_api.v1.model.query.getRootModel().getId();return lab_api.v1.ui.element.getPageSelector({value:t?parseInt(t,10):null,siteId:e?parseInt(e,10):0,attributes:[{name:"name",value:"pageId"},{name:"id",value:"frontrows_pageId"}],pages:lab_api.v1.pages.front.getAll().filter((e=>e.nodeid!==i))})}return{onDisplay:({model:t,view:i,config:s,markup:a})=>{const r=t.get("fields.fragment_json")||{},o={siteselector:a.querySelector('[data-element="siteselector"]'),pageselector:a.querySelector('[data-element="pageselector"]')},n=lab_api.v1.ui.element.getSiteSelector({value:r.siteId?parseInt(r.siteId,10):null,attributes:[{name:"name",value:"siteId"},{name:"id",value:"frontrows_siteId"}]});let l=e(r.siteId||n.value,r.pageId);o.siteselector.appendChild(n),o.pageselector.appendChild(l),n.addEventListener("change",(t=>{l.remove(),l=e(n.value),o.pageselector.appendChild(l)}),!1)},onSubmit:({model:e,view:t,settings:i,markup:s,formValues:a})=>{e.resetExternalResource(),e.set("fields.fragment_json",a)}}}}class E{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("contentbox_settings.frontContent")||{},s=this.api.v1.properties.get("integration_url"),a=Object.values(this.api.v1.config.get("feeds")||{}).filter((e=>!!e.labrador_json)).map((e=>({identifier:e.display_name,name:e.display_name,type:e.url.includes("lab_viewport=json")?"DachserJson":"LabradorApi",url:e.url.replace("{{int}}",s)}))),r=(i.sources||[]).concat(a),o=e.get("fields.source"),n={...r.filter((e=>e.identifier===o)).shift()||{}},l=e.get("fields.organizer"),d=this.api.v1.app.mode.isEditor(),g=e.get("fields.overrideUrlByTagsCookie",!0),c=void 0===g?!!i.overrideUrlByTagsCookie:!!g,p=((e,t)=>{const i=(e.get("fields.tags_string")||"").split(",").map((e=>e.trim())).filter((e=>!!e));return i.length?i:t.map((e=>e.tag))})(e,i.tagsArray||[]),u=((e,t)=>{const i={};for(const e of t)i[e.tag]=e.description;return e.map((e=>({tag:e,description:i[e]||e})))})(p,i.tagsArray||[]),h=e.get("fields.articleCount")||24,m={columnCount:parseFloat(e.get("fields.layout_columnCount")||3),rowCount:parseFloat(e.get("fields.layout_rowCount")||10),maxRowSize:parseFloat(e.get("fields.layout_maxRowSize")||3),minRowSize:parseFloat(e.get("fields.layout_minRowSize")||1),imageAspectRatio:parseFloat(e.get("fields.layout_imageAspectRatio")||.45),gridsize:parseFloat(e.get("fields.layout_gridsize")||12),hide_items:[]};e.get("fields.hide_title")&&m.hide_items.push("title"),e.get("fields.hide_subtitle")&&m.hide_items.push("subtitle"),e.get("fields.hide_image")&&m.hide_items.push("image"),e.get("fields.hide_kicker")&&m.hide_items.push("kicker");const f=[];e.get("fields.filterExisting")&&f.push({path:"contentdata.id",values:this.api.v1.model.query.getModelsByType("article").filter((e=>!!e.get("instance_of"))).map((e=>String(e.get("instance_of"))))});let b=h;["RandomRows"].includes(l)||(b=m.columnCount*m.rowCount||h),e.setFiltered("source",n),e.setFiltered("articleCount",b),e.setFiltered("articleFilterList",JSON.stringify(f)),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug")),e.setFiltered("isEditor",d),e.setFiltered("isConfigured",b&&l&&n.identifier&&n.url&&n.type),e.setFiltered("viewport",this.api.v1.viewport.getName()),e.setFiltered("imageServer",this.api.v1.properties.get("image_server")),e.setFiltered("layout",JSON.stringify(m)),e.setFiltered("coockieOptions",{allow:c,coockieName:i.coockieName||"dachserFrontContentTags",tagsArray:u,tagsArrayString:JSON.stringify(u)}),e.setFiltered("tagOptions",{allow:!!e.get("fields.tags_allow")&&"LabradorApi"===n.type,tags:p,tags_string:p.join(", "),tagsString:JSON.stringify(p)});const y=[];e.get("fields.size_active")&&(e.get("fields.size_title")&&y.push({path:"contentdata.fields.title.attributes.text_size.value",value:parseInt(e.get("fields.size_title"),10)}),e.get("fields.size_subtitle")&&y.push({path:"contentdata.fields.subtitle.attributes.text_size.value",value:parseInt(e.get("fields.size_subtitle"),10)}),e.get("fields.size_kicker")&&y.push({path:"contentdata.fields.kicker.attributes.text_size.value",value:parseInt(e.get("fields.size_kicker"),10)})),e.setFiltered("styleString",JSON.stringify(y)),d&&(n.url&&"LPStream"!==n.type&&(n.url=`${this.api.v1.properties.get("proxy")}?query=${encodeURIComponent(n.url)}`,e.setFiltered("source",n)),e.setFiltered("sourcesConfig",r))}}class j{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.model.query.getRootModel(),s=this.api.v1.config.get("contentbox_settings.googleAd.formats")||[],a=e.get("fields.format"),r=this.api.v1.config.get("adEnvironment")||{},o={bidding:r.bidding,hideOnTabletWidth:r.hideOnTabletWidth||1316};e.setFiltered("googleAds",o);const n=((e,t)=>{for(let i=0;i<t.length;i++)if(t[i].format===e)return{...t[i]};return{}})(a,s);if(n.key=e.get("metadata.key")||"row",o.bidding&&o.bidding.enabled&&o.bidding.provider&&o.bidding.provider.name&&"livewrapped"===o.bidding.provider.name){const e=()=>{const e=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return`${e()+e()}-${e()}-${e()}-${e()}-${e()}${e()}${e()}`};n.code&&n.code.endsWith("-1")&&(n.code+=`_${e()}`)}"mpu_top"===n.code&&(n.isMpuTop=!0),e.setFiltered("adData",n),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug")||e.get("metadata.isDebug"));const l=this.api.v1.config.get("contentbox_settings.googleAd.label")||"Annonse",d=e.get("fields.label")||l;if(e.setFiltered("label",d),!this.api.v1.app.mode.isEditor()){const t=e.parent&&!0===e.parent.get("metadata.hideOnTablet")&&"tablet"===this.api.v1.properties.get("xUaDevice");e.setFiltered("hideOnTablet",t)}if(this.api.v1.app.mode.isEditor()){const t=i.get("type").replace("page_",""),a=[];s.forEach((e=>{(e.selectable&&e.selectable.indexOf(t)>-1||e.selectableOn&&!0===e.selectableOn[t])&&a.push(e)})),e.setFiltered("formatConfigKeys",a)}if((e.get("metadata.css")||"").includes("sticky")){const t=`top: ${this.api.v1.config.get("contentbox_settings.googleAd.spacingTop")||120}px;`;e.setFiltered("spacingTop",t)}}}class P{constructor(e){this.api=e}onRender(e,t){e.setFiltered("cse_id",e.get("fields.cse_id")||this.api.v1.config.get("contentbox_settings.googleCSE.cse_id"))}}class O{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor(),this.isFragmentMode=this.api.v1.app.mode.isFragmentMode(),this.lazyloadImages=!this.isEditor&&!!this.api.v1.config.get("imageLoading.lazy")}check(e,t){if(!this.lazyloadImages||t.getProperty("image.noLazy"))return!1;const i=lab_api.v1.model.query.getParentOfType(e,"row");return!(i&&!this.isFragmentMode&&i.getModelIndex()<5)}}class R{constructor(e){this.api=e,this.lazyloadHelper=new O(e),this.api.v1.app.mode.isEditor()&&(this.cropIds=[],this.rootModel=this.api.v1.model.query.getRootModel(),this.frontcropBinding=this.frontCropChanged.bind(this),this.api.v1.model.bindings.bind(this.rootModel,"frontCrop",this.frontcropBinding),this.frontcropBinding(this.rootModel,"frontCrop",this.rootModel.get("frontCrop")),this.api.v1.ns.set("imageFilter.preview",this.prepareVisualFilters)),this.isFragmentMode=this.api.v1.app.mode.isFragmentMode()}onViewHelper(e,t){if(e.parent){this.prepareForSlideshow(e,t);const i=t.getViewport();if(this.api.v1.view.getView(e.parent,i).get("metadata.hasFullWidth")){const t="mobile"===i?600:1800;e.setFiltered(`width.${i}`,t)}else e.setFiltered(`width.${i}`,null);e.setFiltered("allowFullwidth","image"!==e.parent.getType())}}onRender(e,t){this.setVisualFilters(e,t),e.setFiltered("lazyloadImages",this.lazyloadHelper.check(e,t)),this.setCaptionOptions(e.getParent(),e,t);const i=t.get("fields.float");e.setFiltered("hasFloat",!!i&&"floatNone"!==i)}onRendered(e,t){if(!this.api.v1.app.mode.isEditor()||!this.cropIds.length)return;const i=parseInt(e.get("instance_of"),10);this.cropIds.includes(i)&&this.markFrontCrop(t,i)}setVisualFilters(e,t){e.setFiltered("filters",this.prepareVisualFilters(e,t))}prepareVisualFilters(e,t,i=!1){const s=[],a=e.get("metadata.filter_blur_active")?e.get("metadata.filter_blur_value")||0:null,r=e.get("metadata.filter_sepia_active")?e.get("metadata.filter_sepia_value")||0:null,o=e.get("metadata.filter_saturate_active")?e.get("metadata.filter_saturate_value")||1:null,n=e.get("metadata.filter_brightness_active")?e.get("metadata.filter_brightness_value")||1:null,l=e.get("metadata.filter_contrast_active")?e.get("metadata.filter_contrast_value")||1:null;return null!==a&&s.push(`blur(${a}px)`),null!==r&&s.push(`sepia(${r})`),null!==o&&s.push(`saturate(${o})`),null!==n&&s.push(`brightness(${n})`),null!==l&&s.push(`contrast(${l})`),i?{filter:s.join(" ")}:s.length?`filter: ${s.join(" ")};`:null}markFrontCrop(e,t){const i=document.createElement("span");i.classList.add("labicon-imgFrontCrop","is-frontcrop"),i.setAttribute("title","Image used as front crop. Click to edit"),i.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.api.v1.apps.start("ArticleSettings")}),!1),e.getMarkup().appendChild(i)}frontCropChanged(e,t,i){let s=this.getImages(this.cropIds);this.cropIds=[],this.updateImages(s),i&&(i.pano&&i.pano.instance_of&&this.cropIds.push(i.pano.instance_of),i.height&&i.height.instance_of&&!this.cropIds.includes(i.height.instance_of)&&this.cropIds.push(i.height.instance_of),s=this.getImages(this.cropIds),this.updateImages(s))}getImages(e){const t=[];for(const i of e)t.push(...this.api.v1.model.query.getModelsByKeyAndValue("instance_of",i));return t}updateImages(e){for(const t of e)this.api.v1.model.addToRedrawQueue(t)}setCaptionOptions(e,t,i){const s=e?this.api.v1.view.getView(e,i.getViewport()):null,a=(e,t,i)=>{if(e){const t=e.get(i);if(!t&&null!==t)return!1;if(t)return!0}return!!t.get(i)};let r=a(s,i,"fields.displayCaption"),o=r||null===i.get("fields.displayCaption")&&!i.get("metadata.hidecaption");!this.api.v1.app.mode.isFront()||t.get("fields.imageCaption")||t.get("fields.byline")||(r=!1,o=!1);const n=a(s,i,"fields.expandableCaption"),l=a(s,i,"fields.truncateCaption");let d=t.get("fields.imageCaption");!t.parent||i.getProperty("image.useCaptionForTitle")&&d||(d=t.parent.get("fields.title")||"");const g={title:d,display:r,displayDefault:o,truncate:l,expandable:n||l};t.setFiltered("captionOptions",g)}prepareForSlideshow(e,t){if(!e.parent||"slideshow"!==e.parent.getType())return;if(t.get("fields.whRatio"))return void e.setFiltered("whRatio",null);const i=e.get("fields.originalWidth"),s=e.get("fields.originalHeight");if(s&&i){const t=s/i;e.setFiltered("whRatio",t)}}}class L{constructor(e){this.api=e,this.lazyloadHelper=new O(e)}onRender(e,t){e.setFiltered("lazyloadImages",this.lazyloadHelper.check(e,t))}}class q{static buildConfig(e){return{paywall:{label:e.v1.config.get("paywall.label")}}}}class U{constructor(e){this.api=e}onRender(e,t){const i=lab_api.v1.properties.get("sites"),s=[],a=e.get("fields.allowedSites_json")||{},r=[];if(i.forEach((e=>{const t={alias:e.alias,id:e.id,displayName:e.display_name,selected:!1};s.push(t),a[e.alias]===`${e.id}`&&(t.selected=!0,r.push(t))})),0===r.length){const e=lab_api.v1.properties.get("site");s.forEach((t=>{t.id===e.id&&(t.selected=!0,r.push(t))}))}const o=t.get("fields.orderBy")||"published",n=[{value:"published",label:"Published"},{value:"score",label:"Score"}];n.forEach((e=>{o&&o===e.value&&(e.selected=!0)})),e.setFiltered("sites",s),e.setFiltered("allowedSites",r),e.setFiltered("allowedSitesString",JSON.stringify(r||[])),e.setFiltered("orderByOptions",n),e.setFiltered("clientConfig",JSON.stringify(q.buildConfig(this.api)))}}class N{static mediaQueries={desktop:"(min-width:1024px)",mobile:"(max-width: 1023px)"};static createStyle(e,t,i,s=this.mediaQueries){const a=[];for(const r of i){const i=s[r]?e.get(t,r):null;i&&a.push(`@media ${s[r]} { ${i.selector} { transform: translate(${i.x}px, ${i.y}px); } }`)}return`<style>${a.join("\n")}</style>`}}class H{validate(e=""){return new Promise(((t,i)=>{try{const i=document.createElement("template");i.innerHTML=e.trim(),t(i.innerHTML.trim())}catch(e){i(e)}}))}createElements(e){return[...document.createRange().createContextualFragment(e).children]}}class B{constructor(e){this.api=e,this.validation={suggestedMarkup:null,isUnvalid:!1,error:""}}onRender(e,t){if(t.get("metadata.movableContent")&&e.setFiltered("movableStyle",N.createStyle(e,"metadata.contentPosition",["desktop","mobile"])),!this.api.v1.app.mode.isEditor()&&!0===this.api.v1.config.get("cookieConsent.enabled")){e.setFiltered("requiredCookieConsent",t.get("metadata.requiredCookieConsent")||!1);let i=t.get("fields.markup");i=i.replace(/<\/script>/g,"<\\/script>"),e.setFiltered("markup_escaped",i)}}onSettingsPanel(e,t,i){return{onDisplay:i=>{const s=i.markup.querySelector("textarea");if(!s)return;const a=i.markup.querySelector('input[name="doValidate"]');if(a&&(a.addEventListener("change",(t=>{e.set("fields.skipValidation",!t.target.checked||null)}),!1),a.checked=!e.get("fields.skipValidation")),s.value=t.get("fields.markup"),this.validation.suggestedMarkup){s.value=this.validation.suggestedMarkup;const e=document.createElement("p");this.validation.isUnvalid?e.innerHTML=`<span style="color: red;">Markup is invalid. Please correct the markup and try again.</span><br>${this.validation.error}`:e.innerHTML="Validator has modified markup. Please review the suggested markup below.",s.before(e),this.validation.suggestedMarkup=null,this.validation.isUnvalid=!1,this.validation.error=""}i.markup.querySelector("textarea").focus(),s.addEventListener("keydown",(e=>{if("Tab"===e.key){e.preventDefault();const[t,i]=[s.selectionStart,s.selectionEnd];s.setRangeText("    ",t,i,"end")}}),!1)},onSubmit:({model:e,view:t,config:i,markup:s,modal:a,formValues:r})=>{r.doValidate?(new H).validate(r["fields.markup"]).then((s=>{if(r["fields.markup"].trim()!==s){this.validation.suggestedMarkup=s,this.validation.isUnvalid=!1;const a={...i};return a.defaultButtons=!1,a.container.state.warning=!0,void this.api.v1.ui.modal.panel(e,t,a)}t.set("fields.markup",s)})).catch((s=>{this.validation.suggestedMarkup=r["fields.markup"],this.validation.isUnvalid=!0,this.validation.error=s.message;const a={...i};a.defaultButtons=!1,a.container.state.error=!0,this.api.v1.ui.modal.panel(e,t,a)})):t.set("fields.markup",r["fields.markup"])}}}}class z{constructor(e,t){this.api=e,this.rootModel=e.v1.model.query.getRootModel()}onViewHelper(e,t){const i=this.api.v1.site.getSite();e.setFiltered("siteId",i.id),e.setFiltered("testId",e.get("fields.testId"));const s={0:"Score + pros/cons",1:"Score + pros/cons + specs",2:"Score + specs",3:"Pros/cons + specs",4:"Score",5:"Pros/cons",6:"Specs"},a=e.get("fields.layoutOption")||"0",r={score:"0"===a||"1"===a||"2"===a||"4"===a,prosCons:"0"===a||"1"===a||"3"===a||"5"===a,specs:"1"===a||"2"===a||"3"===a||"6"===a};e.setFiltered("visible",r),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug"));const o=[];for(const e of Object.keys(s))o.push({key:e,value:s[e],selected:e===a});if(e.setFiltered("layoutOptions",o),e.setFiltered("apiEndpoint",s[a]),e.setFiltered("topScore","on"===e.get("fields.topScore")),e.setFiltered("recommended","on"===e.get("fields.recommended")),e.setFiltered("titleWithGrade","on"===e.get("fields.titleWithGrade")),e.setFiltered("titleWithFacts","on"===e.get("fields.titleWithFacts")),this.api.v1.app.mode.isEditor()){const t=[];let i=e.get("fields.score")||"0";i=parseInt(i,10);for(let e=1;e<11;e++)t.push({value:e,selected:i===e?"selected":""});e.setFiltered("scoreOptions",t)}}onRender(e,t){const i=t.get("external");if(!i)return;e.setFiltered("productName",i.namn?i.namn:""),e.setFiltered("pros",i.plus?i.plus:[]),e.setFiltered("cons",i.minus?i.minus:[]),e.setFiltered("structuredData",i.struktureradData?JSON.stringify(i.struktureradData):"");const s=[];i.betyg&&i.betyg.length&&i.betyg.forEach((e=>{let t=!1,i=!1,a=!1;e.v&&(t=e.v,parseInt(e.v,10)<11?a=`${e.v}0`:(a=e.v,i=!0)),s.push({key:e.n,score:t,scoreIsPercent:i,percent:a})})),e.setFiltered("score",s),e.setFiltered("recommended","Ja"===i.braköp||"on"===e.get("fields.recommended")),e.setFiltered("topScore","Ja"===i.toppbetyg||"on"===e.get("fields.topScore")),e.setFiltered("specifications",i.spec?i.spec:[])}onSettingsPanel(e){return this.model=e,{onDisplay:e=>{this.api.v1.apps.start("TextEdit").then((t=>{this.setupRichTextEditing(t,e.markup,this.model)})).catch((e=>{console.log(`Error loading TextEdit-app: ${e}`)}))}}}setupRichTextEditing(e,t,i){for(const s of t.querySelectorAll("div.lab-input-text"))if(s&&s instanceof HTMLElement){const a=s.getAttribute("data-input-key")||"no-key";this.setupRichTextEditingForElement(e,t,s,a,i)}}setupRichTextEditingForElement(e,t,i,s,a){const r={};lab_api.v1.util.object.set(s,a.get(s),r),e.register({element:i,simulatedData:{type:"article",path:"",contentdata:r},toolSettings:{key:s,inlineOnly:!0,displayCharCount:!1,displaySelectionLength:!1,displayWordCount:!1,selectTextOnStart:!1,placeholder:"",attributes:{text_size:{active:!1}}},callbacks:{ended:(e,t)=>{this.model.set(e,t)}},menuSettings:{container:t,items:{bold:{group:"g2",icon:"labicon-text_bold",callback:"toggleAttribute",key:"font_weight",attributes:{class:"font-weight-bold"},value:!1,onValue:"font-weight-bold",offValue:!1,bindToSelection:"font_weight",title:"Font weight - Bold",hotkeys:[{key:"B",controlkeys:["labCtrlKey"],preventDefault:!0,overrideDisable:!0}]},italic:{group:"g2",icon:"labicon-text_italic",callback:"toggleAttribute",key:"italic",attributes:{class:"italic"},value:!1,onValue:"italic",offValue:!1,bindToSelection:"italic",title:"Italic",hotkeys:[{key:"i",controlkeys:["labCtrlKey"],preventDefault:!0,overrideDisable:!0}]},reset:{group:"g4",icon:"labicon-reset_style",callback:"reset",title:"Remove textformatting in selection for viewport"}}}})}}class W{constructor(e){this.api=e}onViewHelper(e,t){const i=this.api.v1.site.getSite();e.setFiltered("siteId",i.id),e.setFiltered("testId",e.get("fields.testId"));const s={summerTire:"tiresummertests",winterTire:"tirewintertests",food:"foodtests",hotel:"hoteltests",vehicle:"vehicletests"},a=e.get("fields.testType")||"vehicle",r="horizontal"===e.get("fields.displayDirection")?"horizontal":"vertical";e.setFiltered("displayDirection",r),e.setFiltered("displayDirectionOptions",[{value:"horizontal",selected:"horizontal"===r},{value:"vertical",selected:"vertical"===r}]),e.setFiltered("needSlider","horizontal"===r),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug"));const o=[];for(const e of Object.keys(s))o.push({value:e,selected:e===a});e.setFiltered("typeOptions",o),e.setFiltered("apiEndpoint",s[a])}onRender(e,t){const i=t.get("external");if(!i)return;const s=e.get("fields.testType")||"vehicle",a={vehicle:{comfort:"Komfort",design:"Design",driveability:"Kjøreegenskaper",environment:"Miljø og forbruk",equipment:"Utstyr",practicality:"Praktisk",price:"Pris",runningCosts:"Driftskostnader",security:"Sikkerhet",value:"Annenhåndsverdi"},food:{firstImpression:"Førsteinntrykk",menu:"Meny",taste:"Smak",price:"Pris",service:"Service",familyFriendly:"Barnevennlig",homemade:"Hjemmelaget",drinks:"Drikke",cleaning:"Renhold",lavatories:"Toaletter"},hotel:{location:"Beliggenhet",rooms:"Rom",standard:"Standard",beds:"Senger",breakfast:"Frokost",bathroom:"Bad",commonAreas:"Fellesområder",cleaning:"Renhold",value:"Valuta for pengene"},summerTire:{asphalt:"Tørr asfalt",asphaltWet:"Våt asfalt",grip:"Grep",breaking:"Bremselengde",driveability:"Kjøreegenskaper",aquaplaning:"Vannplaning",aquaplaningSwing:"Vannplaning sving",comfort:"Komfort",fuelConsumption:"Forbruk",noise:"Støy",other:"Annet"},winterTire:{snow:"Snø",ice:"Is",asphalt:"Tørr asfalt",asphaltWet:"Våt asfalt",breaking:"Bremselengde",driveability:"Kjøreegenskaper",aquaplaning:"Vannplaning",aquaplaningSwing:"Vannplaning sving",comfort:"Komfort",fuelConsumption:"Forbruk",noise:"Støy",grip:"Grep",acceleration:"Akselerasjon",other:"Annet",spikes:"Pigger",count:"Antall",spikeLengthBefore:"Piggutstikk etter innkjøring (mm)",spikeLengthAfter:"Piggutstikk etter snø/istest (mm)",weightKg:"Vekt",installationDescription:"Montering"}},r=[];if(s.indexOf("Tire")>0){const e=new n(this.api.v1.config.get("lang")),t=new Date(i.production.date),o=Number.isNaN(t.getTime())?i.production.date:e.formattedDate(t,"d/m Y");let l="";"winterTire"===s&&(l=`<span class="test-key-value"><span class="test-key">Pigger:</span><span class="test-value">${i.spikes&&i.spikes.isSpikes?i.spikes.count:"nei"}</span></span>`),i.description&&"string"==typeof i.description&&(i.description=i.description.replace(/\n/g,"<br>")),r.push({title:"Fakta",description:`\n                    <span class="test-key-value"><span class="test-key">Produksjonsland:</span><span class="test-value">${i.production.country||""}</span></span>\n                    <span class="test-key-value"><span class="test-key">Produksjonsdato:</span><span class="test-value">${o||""}</span></span>\n                    ${l}\n                    <p>${i.description||""}</p>\n                `}),i.description="",i.loadSpeedRating&&i.loadSpeedRating.length&&(i.description+=`<span class="test-key-value"><span class="test-key">Last- og hastighetsindeks:</span><span class="test-value">${i.loadSpeedRating}</span></span>`),i.shore&&i.shore.length&&(i.description+=`<span class="test-key-value"><span class="test-key">Hardhetstall</span><span class="test-value">${i.shore}</span></span>`),i.installationDescription&&i.installationDescription.length&&(i.description+=`<span class="test-key-value"><span class="test-key">Montering:</span><span class="test-value">${i.installationDescription}</span></span>`),Object.keys(a[s]).forEach((e=>{if(i[e]&&"object"==typeof i[e]&&Array.isArray(Object.keys(i[e]))&&Object.keys(i[e]).length>0){if("spikes"===e&&!i.spikes.isSpikes)return;let t="";Object.keys(i[e]).forEach((r=>{i[e][r]>0&&a[s][r]&&(t+=`<span class="test-key-value"><span class="test-key">${a[s][r]}:</span><span class="test-value">${i[e][r]}</span></span> `)})),r.push({title:a[s][e],description:t})}}))}else Object.keys(a[s]).forEach((e=>{if(i[e]){const t={title:a[s][e],score:i[e].score,description:i[e].description};r.push(t)}}));e.setFiltered("testSubject",i.name?i.name:null),e.setFiltered("totalScore",i.score?i.score:null),e.setFiltered("introduction",i.description?i.description:null),e.setFiltered("mappedCategories",r)}}class V{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("contentbox_settings.newsletter_submit")||{},s=e.get("fields.newsletterDataAction"),a=e.get("fields.newsletterDataTitle"),r=e.get("fields.newsletterDataDescription"),o={provider:i.provider?i.provider:"mailmojo",title:a||(i.title?i.title:"Meld deg på nyhetsbrev"),description:r||i.description,action:s||i.action,elements:i.elements?i.elements:[{type:"hidden",name:"tagsadditional",value:"påmelding fra nettside",class:"",placeholder:""},{type:"email",name:"email",value:"",class:"",placeholder:"Din e-postadresse"},{type:"submit",name:"submit",value:"Abonnér på nyhetsbrevet",class:"bg-secondary",placeholder:""}]};e.setFiltered("newsletter_data",o.action?o:null)}}class Y{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("grid.total_grid_spans"),s=[];let a=!1;if(e.getChildren().forEach(((e,r)=>{const o=[],n=[],l=this.api.v1.view.getView(e,t.getViewport()),d=l.get("metadata.parallax")||{};["scale","rotate","opacity","blur","sepia","brightness"].forEach((e=>{const t=d[e]||{};t.active&&(a=!0,o.push(JSON.stringify({name:e.replace(".","_"),startValue:t.startValue||0,endValue:t.endValue||100,startScrollPosition:t.startScrollPosition||0,endScrollPosition:t.endScrollPosition||100})))})),["perspective"].forEach((e=>{const t=d[e]||{};t.active&&(a=!0,n.push(JSON.stringify({name:e,value:t.value||0})))}));const g=[this.api.v1.style.getStyle(e,l,"background_color"),this.api.v1.style.getStyle(e,l,"background_opacity")];s.push({index:r,type:e.getType(),sticky:!!d.sticky,fullwidth:!!d.fullwidth,height:d.height||"100",spaceBelow:d.spaceBelow||"0",position:d.position,horizontalAlign:d.horizontalAlign,verticalAlign:d.verticalAlign||"top",verticalPosition:d.verticalPosition||"auto",css:g.join(" "),grid:{desktop:this.api.v1.grid.percentToGrid(l.get("width",!1,"desktop"),i),mobile:this.api.v1.grid.percentToGrid(l.get("width",!1,"mobile"),i)},selector:`[data-parallax-layer="${r}"]`,hasAnimations:o.length>0||n.length>0,animations:o,staticAttributes:n})})),e.setFiltered("layers",s),e.setFiltered("elementCount",e.children.length),e.setFiltered("requireJs",a),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug")),!this.api.v1.app.mode.isEditor())return;e.setFiltered("displayNoContent",0===s.length),e.setFiltered("useReflow",!0);const r=Object.keys(t.getProperty("droppable.drop.sourceType")||{});e.setFiltered("supportedContentTypes",r)}}class J{constructor(e){this.api=e}onRender(e,t){function i(e,t,i,s,a,r){return n(function(e,t){return e<<t|e>>>32-t}(n(n(t,e),n(s,r)),a),i)}function s(e,t,s,a,r,o,n){return i(t&s|~t&a,e,t,r,o,n)}function a(e,t,s,a,r,o,n){return i(t&a|s&~a,e,t,r,o,n)}function r(e,t,s,a,r,o,n){return i(t^s^a,e,t,r,o,n)}function o(e,t,s,a,r,o,n){return i(s^(t|~a),e,t,r,o,n)}function n(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}"page_article"===this.api.v1.model.query.getRootModel().getType()&&(this.api.v1.app.mode.isFront()&&!e.get("fields.caption")?e.setFiltered("displayCaption",!1):e.setFiltered("displayCaption",!0));const l=e.get("fields.uvid");let d=new Date;var g,c;d.setHours(d.getHours()+4),d=Math.floor(d.getTime()/1e3),e.setFiltered("dataAttributes",{type:e.get("fields.videoType")||"vod",id:e.get("fields.idString")||"GB001",token:(g=`${l}${d}boqCnvdBXwZTAaa7tMvKkte3MqaufjIZ`,c=function(e){for(var t,i="0123456789ABCDEF",s="",a=0;a<e.length;a++)t=e.charCodeAt(a),s+=i.charAt(t>>>4&15)+i.charAt(15&t);return s}(function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}(function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,l=-271733879,d=-1732584194,g=271733878,c=0;c<e.length;c+=16){var p=i,u=l,h=d,m=g;l=o(l=o(l=o(l=o(l=r(l=r(l=r(l=r(l=a(l=a(l=a(l=a(l=s(l=s(l=s(l=s(l,d=s(d,g=s(g,i=s(i,l,d,g,e[c+0],7,-680876936),l,d,e[c+1],12,-389564586),i,l,e[c+2],17,606105819),g,i,e[c+3],22,-1044525330),d=s(d,g=s(g,i=s(i,l,d,g,e[c+4],7,-176418897),l,d,e[c+5],12,1200080426),i,l,e[c+6],17,-1473231341),g,i,e[c+7],22,-45705983),d=s(d,g=s(g,i=s(i,l,d,g,e[c+8],7,1770035416),l,d,e[c+9],12,-1958414417),i,l,e[c+10],17,-42063),g,i,e[c+11],22,-1990404162),d=s(d,g=s(g,i=s(i,l,d,g,e[c+12],7,1804603682),l,d,e[c+13],12,-40341101),i,l,e[c+14],17,-1502002290),g,i,e[c+15],22,1236535329),d=a(d,g=a(g,i=a(i,l,d,g,e[c+1],5,-165796510),l,d,e[c+6],9,-1069501632),i,l,e[c+11],14,643717713),g,i,e[c+0],20,-373897302),d=a(d,g=a(g,i=a(i,l,d,g,e[c+5],5,-701558691),l,d,e[c+10],9,38016083),i,l,e[c+15],14,-660478335),g,i,e[c+4],20,-405537848),d=a(d,g=a(g,i=a(i,l,d,g,e[c+9],5,568446438),l,d,e[c+14],9,-1019803690),i,l,e[c+3],14,-187363961),g,i,e[c+8],20,1163531501),d=a(d,g=a(g,i=a(i,l,d,g,e[c+13],5,-1444681467),l,d,e[c+2],9,-51403784),i,l,e[c+7],14,1735328473),g,i,e[c+12],20,-1926607734),d=r(d,g=r(g,i=r(i,l,d,g,e[c+5],4,-378558),l,d,e[c+8],11,-2022574463),i,l,e[c+11],16,1839030562),g,i,e[c+14],23,-35309556),d=r(d,g=r(g,i=r(i,l,d,g,e[c+1],4,-1530992060),l,d,e[c+4],11,1272893353),i,l,e[c+7],16,-155497632),g,i,e[c+10],23,-1094730640),d=r(d,g=r(g,i=r(i,l,d,g,e[c+13],4,681279174),l,d,e[c+0],11,-358537222),i,l,e[c+3],16,-722521979),g,i,e[c+6],23,76029189),d=r(d,g=r(g,i=r(i,l,d,g,e[c+9],4,-640364487),l,d,e[c+12],11,-421815835),i,l,e[c+15],16,530742520),g,i,e[c+2],23,-995338651),d=o(d,g=o(g,i=o(i,l,d,g,e[c+0],6,-198630844),l,d,e[c+7],10,1126891415),i,l,e[c+14],15,-1416354905),g,i,e[c+5],21,-57434055),d=o(d,g=o(g,i=o(i,l,d,g,e[c+12],6,1700485571),l,d,e[c+3],10,-1894986606),i,l,e[c+10],15,-1051523),g,i,e[c+1],21,-2054922799),d=o(d,g=o(g,i=o(i,l,d,g,e[c+8],6,1873313359),l,d,e[c+15],10,-30611744),i,l,e[c+6],15,-1560198380),g,i,e[c+13],21,1309151649),d=o(d,g=o(g,i=o(i,l,d,g,e[c+4],6,-145523070),l,d,e[c+11],10,-1120210379),i,l,e[c+2],15,718787259),g,i,e[c+9],21,-343485551),i=n(i,p),l=n(l,u),d=n(d,h),g=n(g,m)}return Array(i,l,d,g)}(function(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}(g),8*g.length))),c.toLowerCase()),expire:d})}}class G{constructor(e){this.api=e}onRender(e,t){const i=t.get("fields.aspectRatio")||t.getProperty("image.defaultAspectRatio")||this.api.v1.config.get("image.defaultAspectRatio")||.5;e.setFiltered("aspectRatio",100*i)}}class Q{static tsvStringToTable(e){return e.split("\n").map((e=>e.split("\t").map((e=>e.trim()))))}static tableToTSVString(e){return e?e.map((e=>e.join("\t"))).join("\n"):null}static getMaxRowLength(e){const t=e.map((e=>e.filter((e=>-1===e.indexOf("|*"))).length));return Math.max.apply(null,t)}static newCell(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e?{style:e,content:t}:{content:t}}static newRow(e,t){return e?{style:e,row:t}:{row:t}}static tableToTemplateBody(e){const t=Q.getMaxRowLength(e);return e.filter((e=>""!==e.join("").trim())).map((e=>{let i=e.map((e=>{if(e.indexOf("|")>-1){const t=e.split("|");return Q.newCell(t[0],t[1])}return Q.newCell(null,e)}));const s="*"===i[i.length-1].content?i[i.length-1].style:null;for(s&&(i=i.slice(0,i.length-1));i.length<t;)i.push(Q.newCell());return Q.newRow(s,i)}))}static templateTableBodyToHeader(e,t){if(!e)return null;const i=e.shift();if(t)for(let t=0;t<i.row.length;t++){const s=e.map((e=>e[t])).filter((e=>/^[0-9, ]+$/.test(e))).length,a=e.map((e=>e[t])).filter((e=>Date.parse(e))).length,r=e.length;i.row[t].sortBy=s===r?"number":a===r?"date":"string"}return i}}class K{constructor(e){this.api=e}onRender(e,t){const i=e.get("fields.tabledata"),s=e.get("fields.tableheader"),a=e.get("fields.tableheadersort");if((null==i||0===i.length)&&this.api.v1.app.mode.isEditor())return void e.setFiltered("missingData","Missing Data");const r=Q.tsvStringToTable(i),o=Q.tableToTemplateBody(r);e.setFiltered("missingData",!1),e.setFiltered("tabledata",Q.tableToTSVString(r)),e.setFiltered("header",s?Q.templateTableBodyToHeader(o,a):null),e.setFiltered("table",o)}}class Z{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("contentbox_settings.tagboard")||{},s=this.api.v1.app.mode.isEditor(),a={tagGroup1_label:e.get("fields.tagGroup1_label")||"",tagGroup1_tags:e.get("fields.tagGroup1_tags")||"",tagGroup2_label:e.get("fields.tagGroup2_label")||"",tagGroup2_tags:e.get("fields.tagGroup2_tags")||"",tagGroup3_label:e.get("fields.tagGroup3_label")||"",tagGroup3_tags:e.get("fields.tagGroup3_tags")||""},r=((e={})=>{const t=[],i=(e="")=>e.split(",").map((e=>e.trim().toLowerCase())).filter((e=>!!e));for(let s=1;s<=3;s++)e[`tagGroup${s}_tags`]&&t.push({label:e[`tagGroup${s}_label`],tags:i(e[`tagGroup${s}_tags`])});return t})(a);r.length&&Array.isArray(r)||Sys.logger.warning('tagboard: Missing required config "contentbox_settings.tagboard.tagGroups" (array). End user will not be able to filter results.');let o=e.get("fields.tagsGroupsDefaultVisible");null===o&&(o=this.api.v1.config.get("contentbox_settings.tagboard.tagsOptions.tagsGroupsDefaultVisible"));const n=r.map((e=>e.tags)),l=[].concat(...n),d=this.api.v1.properties.get("integration_url"),g=Object.values(this.api.v1.config.get("feeds")||{}).filter((e=>!!e.labrador_json)).map((e=>({identifier:e.display_name,name:e.display_name,type:e.url.includes("lab_viewport=json")?"DachserJson":"LabradorApi",url:e.url.replace("{{int}}",d)}))),c=(i.sources||[]).concat(g),p=e.get("fields.source"),u={...c.filter((e=>e.identifier===p)).shift()||{}},h=e.get("fields.organizer"),m={columnCount:parseFloat(e.get("fields.layout_columnCount")||3),rowCount:parseFloat(e.get("fields.layout_rowCount")||10),maxRowSize:parseFloat(e.get("fields.layout_maxRowSize")||3),minRowSize:parseFloat(e.get("fields.layout_minRowSize")||1),imageAspectRatio:parseFloat(e.get("fields.layout_imageAspectRatio")||.45),gridsize:parseFloat(e.get("fields.layout_gridsize")||12),hide_items:[]};e.get("fields.hide_title")&&m.hide_items.push("title"),e.get("fields.hide_subtitle")&&m.hide_items.push("subtitle"),e.get("fields.hide_image")&&m.hide_items.push("image"),e.get("fields.hide_kicker")&&m.hide_items.push("kicker");const f=e.get("fields.articleCount")||24;let b=f;["RandomRows"].includes(h)||(b=m.columnCount*m.rowCount||f);const y=[];e.get("fields.filterExisting")&&y.push({path:"contentdata.id",values:this.api.v1.model.query.getModelsByType("article").filter((e=>!!e.get("instance_of"))).map((e=>String(e.get("instance_of"))))}),e.setFiltered("articleCount",b),e.setFiltered("articleFilterList",JSON.stringify(y)),e.setFiltered("tagArrayGroups",JSON.stringify(n)),e.setFiltered("tagGroups",r),e.setFiltered("tagGroupsObject",a),e.setFiltered("tagsGroupsDefaultVisible",o),e.setFiltered("layout",JSON.stringify(m)),e.setFiltered("isConfigured",h&&u.identifier&&u.url&&u.type),e.setFiltered("source",u),e.setFiltered("isDebug",!0),e.setFiltered("siteId",e.get("fields.siteId")||""),e.setFiltered("viewport",this.api.v1.properties.get("device")),e.setFiltered("imageServer",this.api.v1.properties.get("image_server")),e.setFiltered("tagOptions",{allow:!0,tags:l,tags_string:l.join(", "),tagsString:JSON.stringify(l)});const v=[];e.get("fields.size_active")&&(e.get("fields.size_title")&&v.push({path:"contentdata.fields.title.attributes.text_size.value",value:parseInt(e.get("fields.size_title"),10)}),e.get("fields.size_subtitle")&&v.push({path:"contentdata.fields.subtitle.attributes.text_size.value",value:parseInt(e.get("fields.size_subtitle"),10)}),e.get("fields.size_kicker")&&v.push({path:"contentdata.fields.kicker.attributes.text_size.value",value:parseInt(e.get("fields.size_kicker"),10)})),e.setFiltered("styleString",JSON.stringify(v)),e.setFiltered("imageWidth",e.get("fields.imageWidth")||100),s&&e.setFiltered("sourcesConfig",c)}}class X{constructor(e){this.api=e}onRender(e,t){const i="center"===t.get("metadata.text_align");e.setFiltered("textCentered",i)}}class ee{constructor(e){this.api=e}onRender(e,t){const i={tips:{cssClass:"tips_version",title:"Tips og innlegg",text:"Vi synes det er viktig med dine meninger",buttons:{tips:"Tips oss",debate:"Send innlegg"}},debate:{cssClass:"debate_version",title:"Har du noe på hjertet?",text:"Send oss et debattinnlegg, en kronikk eller en meningsytring. Alle innlegg signeres med fullt navn og tittel.",buttons:{tips:null,debate:"Send innlegg"}}},s=this.api.v1.config.get("contact.email")||{},a={tips:e.get("fields.email_tips"),debate:e.get("fields.email_debate"),version:e.get("fields.version")};a.tips&&(s.tips=a.tips),a.debate&&(s.debate=a.debate),e.setFiltered("content","tips"===a.version?i.tips:i.debate),e.setFiltered("version_is_tips","tips"===a.version),e.setFiltered("emails",s)}}class te extends n{constructor({languageCode:e}={}){super("en"),this.languageCode=e||lab_api.v1.config.get("contentLanguage")}str(e,{data:t,noRender:i}={}){return lab_api.v1.locale.get(`dates.${e}`,{data:t,noRender:i})}timestampToNiceDate(e,t=!1){const i=(new Date).getTime(),s=new Date(1e3*e).getTime()-0,a=parseInt((i-s)/1e3/60,10);if(a<60)return a<1?this.str("now"):this.str("durationSince",{data:{count:a,period:t?this.str("min"):1===a?this.str("minute"):this.str("minutes"),ago:t?"":this.str("ago")}});if(a<1440){const e=parseInt(a/60,10);return this.str("durationSince",{data:{count:e,period:1===e?this.str("hour"):this.str("hours"),ago:t?"":this.str("ago")}})}if(parseInt(a/1440,10)<30){const e=parseInt(a/1440,10);return this.str("durationSince",{data:{count:e,period:1===e?this.str("day"):this.str("days"),ago:t?"":this.str("ago")}})}return this.format(this.timestampToDate(e),this.str("monthdayyear",{noRender:!0}))}}class ie{constructor(e){this.api=e}onViewHelper(e,t){let i=e.get("fields.domain")||this.api.v1.properties.get("site.domain");i=i.replace(/^https?:\/\//,"");const s=e.get("fields.limit")||5;e.setFiltered("domain",i),e.setFiltered("limit",s)}onRender(e,t){const i=t.get("external"),s=!!e.get("fields.displayImages"),a=!e.get("fields.hideDate"),r=e.get("fields.limit")||5,o=e.get("filtered.domain"),n=[],l=i&&"object"==typeof i?i:(e=>{const t=[];for(let i=0;i<e;i++)t.push({fields:{cssClass:"dac-placeholder-text",type:"article"}});return{data:t}})(r),d=new te;if(l.data.forEach((e=>{if("article"===e.fields.type){const i=e.fields.published||null;n.push({title:e.fields.title||"[no title]",url:e.fields.srcUrl,section:e.fields.section||"",pageviews:e.fields.pageviews,published:i,niceDate:a&&i?d.timestampToNiceDate(d.toTimestamp(new Date(i))):"",cssClass:e.fields.cssClass||null,imageUrl:s?(t=e.fields.image,t?`${t.replace(/^https?:\/\//,"//")}${t.includes("?")?"&":"?"}width=100&height=70`:null):null})}var t})),e.setFiltered("result",n),!this.api.v1.app.mode.isEditor())return;const g={domains:[],layout:[]};this.api.v1.site.getSites().forEach((e=>{if(!e.domain)return;const t=e.domain.replace(/^https?:\/\//,""),i={name:e.display_name,value:t,selected:t===o};g.domains.push(i)}));for(const e of["horizontal","vertical"])g.layout.push({name:e,value:e,selected:e===t.get("fields.layout")});e.setFiltered("adminView",g)}}class se{constructor(e){this.api=e}onRender(e,t){const i=t.get("external.tv");if(!i||!i.length)return;const s=i[0],a=new n(lab_api.v1.config.get("lang")),r=(e,t="d/m Y H:i")=>{const i=new Date(e);return a.formattedUtcDate(i,t)},o=e=>e.replace("00000+","00.000+"),l=e=>a.isSummerTime(e)?a.manipulateTime(e,1):e,d=e=>{const t=new Date(e);return`${t.getUTCFullYear()}${`0${t.getUTCMonth()+1}`.slice(-2)}${`0${t.getUTCDate()}`.slice(-2)}`},g=s.programme.filter((e=>{let t=new Date(o(e.start));return t=l(t),!(new Date(t.toUTCString().split(" ").slice(0,4).join(" "))<new Date((new Date).toUTCString().split(" ").slice(0,4).join(" ")))})).map((e=>{const t=l(new Date(o(e.start))).toUTCString();return{start:r(t,"H:i"),icon:e.icon[0].src,title:e.title[0]._,desc:e.desc[0]._,date:d(t)}})),c={};for(const e of g){if(!c[e.date]){const t=a.parseDate(e.date);c[e.date]={date:a.formattedDate(t,"d/m Y"),items:[]}}c[e.date].items.push(e)}e.setFiltered("tvguide",Object.values(c))}}class ae{constructor(e){this.api=e}onViewHelper(e,t){const i=e.get("fields.lang")||lab_api.v1.config.get("lang")||"no";e.setFiltered("lang",i)}}class re{constructor(e){this.api=e}onRender(e,t){const i=this.api.v1.config.get("contact.email")||{},s=e.get("fields.email")||i.tips||"",a=e.get("fields.url")||"";e.setFiltered("email",s),e.setFiltered("url",a)}}class oe{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor()}onRender(e,t){let i="page_article"===this.api.v1.model.root.getType();if(this.api.v1.app.mode.isFront()&&!t.get("fields.caption")&&(i=!1),e.setFiltered("displayCaption",i),!this.api.v1.app.mode.isEditor()&&!0===this.api.v1.config.get("cookieConsent.enabled")){const t=this.api.v1.config.get("cookieConsent").contentboxes.filter((e=>"youtube"===e.name))[0];t&&(e.setFiltered("requiredCookieConsent",t.requiredConsent||!1),e.setFiltered("insufficientConsentMessage",t.insufficientConsentMessage||this.api.v1.config.get("cookieConsent.insufficientConsentMessage")||""))}const s=[],a=e.get("fields.video_start"),r=e.get("fields.video_end");a&&s.push(`start=${Math.round(a)}`),r&&s.push(`end=${Math.round(r)}`),s.length&&e.setFiltered("startstop",`?${s.join("&")}`)}onRendered(e,t){if(this.isEditor){const e=t.getMarkup().querySelector("iframe"),i=t.getMarkup().querySelector(".youtube-drag-handle");e&&i&&(i.addEventListener("mouseenter",(t=>{e.style.pointerEvents="none"}),!1),i.addEventListener("mouseleave",(t=>{e.style.pointerEvents=""}),!1))}}}class ne{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor()}onRender(e,t){let i="page_article"===this.api.v1.model.root.getType();if(this.api.v1.app.mode.isFront()&&!t.get("fields.caption")&&(i=!1),e.setFiltered("displayCaption",i),!this.api.v1.app.mode.isEditor()&&!0===this.api.v1.config.get("cookieConsent.enabled")){const t=this.api.v1.config.get("cookieConsent").contentboxes.filter((e=>"jwplayer"===e.name))[0];t&&(e.setFiltered("requiredCookieConsent",t.requiredConsent||!1),e.setFiltered("insufficientConsentMessage",t.insufficientConsentMessage||this.api.v1.config.get("cookieConsent.insufficientConsentMessage")||""))}}onRendered(e,t){if(this.isEditor){const e=t.getMarkup().querySelector("iframe"),i=t.getMarkup().querySelector(".jwplayer-drag-handle");e&&i&&(i.addEventListener("mouseenter",(t=>{e.style.pointerEvents="none"}),!1),i.addEventListener("mouseleave",(t=>{e.style.pointerEvents=""}),!1))}}}class le{constructor(e){this.api=e,this.domain=this.api.v1.site.getSite().domain||this.api.v1.properties.get("customer_front_url")}onViewHelper(e,t){e.setFiltered("domain",e.get("fields.domain")||this.domain.replace("https://",""))}onRender(e,t){const i=t.get("external");if(!i)return;const s=new n(lab_api.v1.config.get("lang")),a=this.api.v1.config.get("contentbox_settings.topcomments.dateTemplate"),r=lab_api.v1.properties.get("image_server"),o=[],l=lab_api.v1.util.object.clone(i,!0);for(const e of l.mostRead||[]){const t=new Date(e.fields.published);e.fields.image&&(e.fields.image=e.fields.image.replace("http://","https://"),e.resizedImage=`${e.fields.image}&width=63&height=63`),e.fields.readableDate=s.utcFormat(t,a),o.push(e)}e.setFiltered("mostRead",o);const d=[];for(const e of l.latest||[]){const t=new Date(e.published);e.readableDate=s.utcFormat(t,a),e.extId?e.disqusId=e.extId.replace("khrono-","node/"):e.disqusId=e.id,e.frontCropUrl&&(e.resizedImage=`${r}/${e.frontCropUrl}&width=63&height=63`),d.push(e)}e.setFiltered("latest",d);let g=e.get("fields.selectedTab")||"latest";"mobile"===lab_api.v1.viewport.getName()&&e.get("fields.hideResultOnMobile")&&(g="");const c={};["mostRead","topComments","latest"].forEach((e=>{c[e]=e===g})),e.setFiltered("selectedTabs",c),e.setFiltered("isDebug",this.api.v1.util.request.hasQueryParam("debug"))}}class de{constructor(e){this.api=e}onChildAdded(e,t){if("article"!==t.getType())return;const i=(e,t,i)=>{if(t)for(const s of Object.keys(t))s.includes("viewports_json")||(t[s]&&"object"==typeof t[s]?e.setRaw((i||"")+s,t[s]):e.set((i||"")+s,t[s]))};i(t,this.api.v1.config.get("contentbox_settings.scrollbox.dataForAddedChild.article.metadata"),"metadata."),i(t,this.api.v1.config.get("contentbox_settings.scrollbox.dataForAddedChild.article.contentdata")),t.children.length&&"image"===t.children[0].getType()&&i(t.children[0],this.api.v1.config.get("contentbox_settings.scrollbox.dataForAddedChild.article.children.image.contentdata"))}}class ge{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor()}onInserted(e){const t=e.get("metadata.visibleAfterDate");if(t){const i=this.stringToDate(t);if(i){const s=(new Date).getTime();i.getTime()>s&&(this.api.v1.app.mode.isEditor()||(Sys.logger.debug(`[Baseview] The path 'metadata.visibleAfterDate' ('${t}') has prevented the row '${e.getPositionedPath()}' from rendering`),this.api.v1.model.noRender(e)))}}}onRender(e,t){t.get("metadata.movableContent")&&e.setFiltered("movableStyle",N.createStyle(e,"metadata.contentPosition",["desktop","mobile"]));const i=e.get("metadata.visibleAfterDate");if(i){const s=this.stringToDate(i);if(s){const i=(new Date).getTime();s.getTime()>i&&this.api.v1.app.mode.isEditor()&&t.addCssStates(["hidden-on-front","has-date-restriction"]),this.isEditor&&(s.setMinutes(s.getMinutes()-s.getTimezoneOffset()),e.setFiltered("visibleAfterDate",s.toISOString().slice(0,16)))}}}onSettingsPanel(){return{onSubmit:({model:e,formValues:t})=>{for(const t of this.api.v1.view.getViews(e))t.resetCssState();const i=this.stringToDate(t["metadata.visibleAfterDate"]);let s;i?s=i.toISOString():(e.setFiltered("visibleAfterDate",null),s=null),e.set("metadata.visibleAfterDate",s)}}}stringToDate(e){const t=new Date(e||"");return t instanceof Date&&Number.isFinite(t.getTime())?t:null}}class ce{constructor(e){this.api=e,this.isEditor=this.api.v1.app.mode.isEditor(),this.isEditor&&this.api.v1.ns.set("timeline.insertItem",((e,t,i,s)=>{this.addItem(e)}))}addItem(e){const t=new Date,i=this.api.v1.model.create.view({type:"timelineItem",contentdata:{fields:{date:`${(t.getHours()<10?"0":"")+t.getHours()}.${(t.getMinutes()<10?"0":"")+t.getMinutes()}`}}});this.api.v1.model.prependChild(e,i)}}class pe{constructor({path:e=null,selector:t=null,data:i={},options:s={}}={}){this.path=e,this.selector=t,this.data=i,this.options={persistentTarget:!0,intermediate:{useExisting:!0},...s}}}class ue{constructor({key:e=null,path:t=null,selector:i=null,placeholder:s=null,metadata:a={},options:{shouldInsert:r=!0,wrap:o=null,skipIfOutOfBounds:n=!1,useIndex:l=!1,useBodyTextIndex:d=!1,useBodyTextHeadingIndex:g=!1,lastBodyTextHeading:c=!1}={}}={}){this.key=e,this.path=t,this.selector=i,this.placeholder=s,this.metadata=a,this.options={shouldInsert:r,wrap:o,skipIfOutOfBounds:n,useIndex:l,useBodyTextIndex:d,useBodyTextHeadingIndex:g,lastBodyTextHeading:c}}}class he{constructor({type:e=null,contentdata:t=null,content_data:i=null,cssSettings:s={},children:a=[],metadata:r={}}={}){this.type=e,this.contentdata=t||i,this.children=a,this.metadata={...r},this.state={};const o=[];this.metadata.css&&o.push(this.metadata.css);for(const e of Object.keys(s))s[e]&&o.push(e);this.metadata.css=o.join(" ")}}class me{constructor(e){this.api=e,this.page=this.api.v1.model.query.getRootModel(),this.pageType=this.api.v1.model.root.getType().replace("page_",""),this.viewports=this.api.v1.viewport.getActive(),this.isEditor=this.api.v1.app.mode.isEditor(),this.cache=new Map}insert(e,t=null){const i=`insertDynamic.${this.pageType}.${e}`,s=`placements.${this.pageType}.${e}`;if(!this.cache.has(i)){const e=this.isEditor?(this.api.v1.config.get(i)||[]).filter((e=>!e.dynamicDataSettings||!e.dynamicDataSettings.hideInEditMode)):this.api.v1.config.get(i)||[];this.cache.set(i,e.map((e=>e)))}if(!this.cache.has(s)){const e=this.api.v1.config.get(s)||[];this.cache.set(s,e.map((e=>new ue(e))))}const a=this.parse(this.cache.get(i),this.cache.get(s),e,t);for(const e of a)e.selector?this.api.v1.model.insert.bySelector({selector:e.selector,data:e.data,options:e.options}):e.path&&this.api.v1.model.insert.atPath({path:e.path,data:e.data,options:e.options})}parse(e=[],t=[],i="desktop",s=null){const a=[];for(const r of e){const[o]=t.filter((({key:e})=>e===r.placement.key));if(o)if(this.acceptPath(o.path,s)){const t=this.create(r,o,e,i);null!==t&&(t.data.metadata.viewportBlacklist=this.viewports.filter((e=>e!==i)),a.unshift(t))}else Sys.logger.debug(`[DynamicDataHelper]: Path "${o.path}" not allowed. Filter: "${s}", key: "${r.placement.key}"`);else Sys.logger.debug(`[DynamicDataHelper]: No placement found with key "${r.placement.key}"`)}return a}create(e,t,i,s="desktop"){if(this.filter(e)){const a=this.assemble(e,t);t.path&&t.selector&&(this.api.v1.model.query.getModelBySelector(t.selector)||this.api.v1.model.insert.atPath({path:t.path,data:{type:"placeholder",selector:t.selector,metadata:{...t.metadata||{},key:t.key},state:{isNonPersistent:!0}},options:{index:0,useExisting:!0,prepend:!0,silent:!0}}));const r={...e.options,prepend:!0,silent:!0};let{path:o}=t,n=e.placement.index||0,l=null;if(t.selector)l=this.api.v1.model.query.getModelBySelector(t.selector);else if(t.path){const e=this.getModelsByPath(t.path,s);e.length&&(l=t.options.useBodyTextIndex||t.options.useBodyTextHeadingIndex||t.options.lastBodyTextHeading?e.find((e=>"bodytext"===e.getType())):t.options.shouldInsert?e[0].children[n]:e[n])}if(l||!t.options.skipIfOutOfBounds){if(l){n=this.api.v1.model.query.getIndex(l);let e=l.getParent();if("mobile"===s){if(n>0&&n<e.children.length){let t=e.children[n];for(;t;){const i=l.get("width",s,!0);if(void 0===i||100===i)break;t=e.children[++n]}}e.get("metadata.hasRowTitle")&&(0===n||n>=e.children.length)&&(l=e,e=l.getParent(),n=this.api.v1.model.query.getIndex(l),o=e.getPositionedPath())}if(t.options.useIndex&&n<e.children.length)if(e.children[n-1]&&e.children[n-1].getNoRenderState()){if(i[n+1]&&i[n+1].placement.index===n+1)return null;r.index=n+1}else r.index=n;t.options.shouldInsert||(o=e.getPositionedPath())}else r.prepend=!1;return new pe({data:a,options:r,selector:t.selector,path:o})}}return null}assemble(e,t){let i=new he(e);return t.selector||(i.metadata={...i.metadata,...t.metadata,css:t.metadata.css?`${i.metadata.css} ${t.metadata.css}`:i.metadata.css||""}),t.options.wrap&&(i=new he({type:t.options.wrap.type,metadata:t.options.wrap.metadata,children:[i]})),t.options.skipIfOutOfBounds&&(i.metadata.skipIfOutOfBounds=!0),t.options.useBodyTextIndex?i.metadata.bodyTextIndex=e.placement.index||0:t.options.useBodyTextHeadingIndex&&(i.metadata.bodyTextHeadingIndex=e.placement.index||0),t.options.lastBodyTextHeading&&(i.metadata.lastBodyTextHeading=!0),i.state.isNonPersistent=!0,i}acceptPath(e,t){return!e||!t||e===t}filter(e){const t=this.page.get("fields.hideAds");return"googleAd"!==e.type&&"adnuntiusAd"!==e.type||"1"!==t&&!0!==t}getModelsByPath(e,t){const i=`getByPath-${e}`;return this.cache.has(i)||this.cache.set(i,(this.api.v1.model.query.getModelsByPath(e)||[]).filter((e=>!e.get("metadata.hideViewport",t)&&!e.isNonPersistent()))),this.cache.get(i)}}class fe{constructor(e){this.api=e,this.request=this.api.v1.util.request}listen(){const e={selector:this.request.getQueryParam("lab_selector")||"contentFromPath",path:this.request.getQueryParam("lab_path"),guid:this.request.getQueryParam("lab_guid")};(e.guid||e.path)&&this.api.v1.model.on("insert",(t=>{const i=e.guid?this.getModelByGuid(e.guid,t):this.getModelByPath(e.path,t);if(i)return Sys.logger.debug(`[FragmentHelper] Element found. Path: ${i.getPositionedPath()}, GUID: ${i.getGuid()}.`),i.setSelector(e.selector),"embed"===lab_api.v1.viewport.getName()?this.appendToRoot(t,i):[i]}))}getModelByGuid(e){return Sys.logger.debug(`[FragmentHelper] Will filter elements by guid: "${e}".`),this.api.v1.model.query.getModelByGuid(e)}getModelByPath(e,t){Sys.logger.debug(`[FragmentHelper] Will filter elements by path: "${e}".`);const i=this.api.v1.util.string.parsePath(e);if(!i[0])return null;const s=this.api.v1.model.query.getModelsByType(i[0].base,t);return this.api.v1.model.query.getModelByPath(e,!0,!1,s)}appendToRoot(e,t){const i=e[0];return i.children=[t],[i]}}class be{constructor(e){this.api=e,this.paths={main:["parent","guid","type","tags"],fields:["feedId","byline","bylineImage","paywall","published","published_url","site_alias","site_id","subtitle","subtitleHTML","teaserSubtitle","somedescription","title","teaserTitle","titleHTML","seolanguage","seotitle","sometitle","kicker","teaserKicker","showcomments"],fieldsAuto:["section_tag","tags"],fieldsNative:["section"],fieldMap:{subtitle:"description",subtitleHTML:"descriptionHTML",somedescription:"someDescription",teaserSubtitle:"teaserDescription",seolanguage:"seolanguage",seotitle:"seoTitle",sometitle:"someTitle",published_url:"url",section_tag:"section"},fallback:{url:"url"}},this.frontUrl=this.api.v1.site.getSite().domain||this.api.v1.properties.get("customer_front_url"),this.imageServer=this.api.v1.properties.get("image_server")}jsonData(e){Sys.logger.debug("[PageExport] Will export page as JSON-data");const t=this.api.v1.model.serialize.model(e);return delete t.guid,{page:t,result:"page_article"===e.getType()?this.exportArticle():this.exportFront()}}exportArticle(){}exportFront(){const e=this.api.v1.model.query.getModelByType("dropZone");return this.api.v1.model.query.getModelsByType("article",[e]).map((e=>this.serialize(e))).filter((e=>!!e))}serialize(e){const t=this.api.v1.model.serialize.model(e);if(!t||!t.fields)return null;const i=!!t.fields.origin_data_json,s={images:[],width:e.getWidth("desktop"),metadata:t.metadata,isAutomatic:i,siteDomain:this.frontUrl},a=i?t.fields.origin_data_json:t.fields,r=[...this.paths.fields,...i?this.paths.fieldsAuto:this.paths.fieldsNative];for(const e of this.paths.main)s[e]=t[e]||"";for(const e of r)s[this.paths.fieldMap[e]||e]=a[e]||"";if(s.teaserSubtitle=a.teaserSubtitle||"",i){if(!s.byline){const e=(a.full_bylines||[]).shift();s.byline=e?`${e.firstname} ${e.lastname}`:"",s.bylineImage=s.bylineImage||(e||{}).imageUrl}"string"==typeof s.tags&&(s.tags=s.tags.split(",").map((e=>(e||"").trim()))),s.site_alias=(this.api.v1.site.getSiteById(a.site_id)||{}).alias,s.id=parseInt(a.id,10)}else s.titleHTML=s.title,s.title=this.cleanText(s.title),s.descriptionHTML=s.description,s.description=this.cleanText(s.description),s.kickerHTML=s.kicker,s.kicker=this.cleanText(s.kicker),s.id=t.id;s.section_tag=s.section,s.url&&!s.url.startsWith("http")&&(s.url=this.frontUrl+s.url);for(const e of Object.keys(this.paths.fallback))s[e]||(s[e]=a[this.paths.fallback[e]]||"");s.full_bylines=(i?a.full_bylines:a.full_bylines_json)||[],s.full_bylines=s.full_bylines.map((e=>({firstname:e.firstname,lastname:e.lastname,imageUrl:this.getImageUrl(e.imageUrl)}))),i&&s.byline&&s.full_bylines.unshift({firstname:s.byline,lastname:"",imageUrl:this.getImageUrl(s.bylineImage)}),!s.byline&&s.full_bylines.length&&(s.byline=`${s.full_bylines[0].firstname} ${s.full_bylines[0].lastname}`,s.bylineImage=s.full_bylines[0].imageUrl.replace(this.imageServer,""));const o=lab_api.v1.config.get("customAdapterFields.article")||[];if(o)for(const e of o)if(e){let i=t.fields[e]||"";!i&&t.fields.origin_data_json&&(i=t.fields.origin_data_json[e]||""),i&&(s[e]=i)}s.paywall="0"!==s.paywall&&!!s.paywall;const n=this.api.v1.model.query.getChildOfType(e,"image");if(n){const e=n.get("filtered.image");e&&s.images.push({url:e,jpg:`${e}&format=jpg`,webp:`${e}&format=webp`,url_size:e,default:"1",id:n.get("instance_of")})}return s}cleanText(e){return this.api.v1.util.string.sanitizeString(e).replace(/&amp;/g,"&")}getImageUrl(e){return e?e.startsWith("http")?e:this.imageServer+e:""}}class ye{constructor(e){this.api=e}register(e,t){if(this.api.v1.app.mode.isFragmentMode())return void Sys.logger.debug("[EsiHelper] Labrador is is fragment-mode. Will not register ESI. Skipping.");if(!e)return void Sys.logger.debug("[EsiHelper] Missing model, cannot process. Skipping.");const i=this.api.v1.config.get("footer.include");if(i&&i.pageId){const t=this.getEsiUrl(i);t?"client"===i.render?e.setFiltered("renderFooter.url",t):this.insertEsi(e,t,"esi_footer"):Sys.logger.warning("[EsiHelper] Cannot prepare url for footer-fragment. Missing url.")}const s=this.api.v1.config.get("header.include"),a=this.api.v1.config.get("header.includes")||[],r=[];if(s&&s.pageId){const t=this.insertHeader(s,e);t&&r.push(t)}for(const t of a)if(t&&t.pageId){const i=this.insertHeader(t,e);i&&r.push(i)}e.setFiltered("renderHeader.urls",r.map((e=>`'${e}'`)).join(", "))}getEsiUrl(e){if(!e.pageId)return null;const t=["pageId","path","structureType","start","count"],i=[];if(t.forEach((t=>{void 0!==e[t]&&""!==e[t]&&null!==e[t]&&i.push(`${t}=${e[t]}`)})),i.length===t.length){let e=this.api.v1.properties.get("front_api_url");return this.api.v1.app.mode.isEditor()&&"https:"===document.location.protocol&&(e=e.replace("http:","https:")),`${e}/fragment/structure/?${i.join("&")}`}return null}insertEsi(e,t,i){Sys.logger.debug(`[EsiHelper] Will insert fragment for selector: "${i}", url: "${t}".`),this.api.v1.model.insert.atPath({path:e.getPath(),data:{type:"esi",selector:i,contentdata:{fields:{url:t,identifier:i}},state:{isNonPersistent:!0}},options:{frontpage:!0,articlepage:!0}}),this.api.v1.app.mode.isEditor()&&this.fetchEditorEsi(t,`${i}`)}insertHeader(e,t){const i=this.getEsiUrl(e);if(i){if("client"===e.render)return Sys.logger.debug(`[EsiHelper] Found url for header-fragment to render in client: "${i}".`),i;this.insertEsi(t,i,"esi_header")}else Sys.logger.warning("[EsiHelper] Cannot prepare url for header-fragment. Missing url.");return null}fetchEditorEsi(e,t){this.api.v1.view.on("domRendered",((i,s)=>{const a=this.api.v1.model.query.getModelBySelector(t);a&&(Sys.logger.debug(`EsiHelper.fetchEditorEsi: Will fetch esi-substitute for editor. Selector: ${t}, url: ${e}`),this.api.v1.util.httpClient.get(e,{credentials:"omit",type:"text"}).then((e=>{const i=lab_api.v1.view.getView(a,s),r=document.createElement("template");if(r.innerHTML=e,Sys.logger.debug(`EsiHelper.fetchEditorEsi: Esi-substitute fetched. Selector: ${t}, element-count: ${r.content.children.length}`),i.markup){for(const e of[...r.content.children])i.markup.parentElement.insertBefore(e,i.markup);i.markup.remove()}else Sys.logger.warn(`EsiHelper.fetchEditorEsi: Element markup not found. Cannot insert dom-element(s). Selector: ${t}`)})).catch((e=>{Sys.logger.warning(`EsiHelper.fetchEditorEsi: Esi-substitute could not be fetched. Selector: ${t}, error: ${e}`)})))}))}}class ve{static mediaQueries={desktop:"(min-width:1024px)",mobile:"(max-width: 1023px)"};static createStyle({model:e,view:t,viewports:i,styleCollection:s="content_inline_spacing",mediaQueries:a=this.mediaQueries,returnArray:r=!1}){const o=[],n=`[data-element-guid="${e.getGuid()}"] .content`;for(const r of i)if(a[r]){const i=lab_api.v1.style.getStyles(e,t,s,r);i&&o.push(`@media ${a[r]} { ${n} { ${i} } }`)}return r?o:`<style>${o.join("\n")}</style>`}}const _e=class{constructor(){this.name="Baseview",this.api=null,this.pageAPI=null,this.useSpacing=!1}onReady(e){if(this.api=e,"json"===this.api.v1.viewport.getName()&&"PageExport.jsonData"===this.api.v1.config.get("viewports.json.renderer")){const e=new be(this.api);lab_api.v1.view.on("rendered",((t,i)=>[JSON.stringify(e.jsonData(lab_api.v1.model.query.getRootModel()),null,4)]))}new fe(this.api,this.api.v1.util.request).listen()}onAcceptContent(){const e=this.api.v1.model.query.getRootModel();this.useSpacing=!(!e||!e.get("fields.style_spacing")),"editor"!==this.api.v1.app.mode.getSimulatedMode()?(new me(this.api).insert(this.api.v1.viewport.getName()),new ye(this.api).register(e,lab_api.v1.site.getSite().alias)):Sys.logger.debug("[Front] Labrador is running in simulated editor-mode. Skipping DynamicDataHelper and EsiHelper.")}onRender(e,t){this.useSpacing&&e.setFiltered("styleSheets",ve.createStyle({model:e,view:t,viewports:["desktop","mobile"],returnArray:!1}))}};(labradorView=void 0===labradorView?{}:labradorView).baseview=t})();